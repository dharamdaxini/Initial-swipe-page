<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VIA.STACK | MASTER LAB v133.27</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#050505;--panel:#0a0a0a;--border:#222;
  --gold:#ffd600;--blue:#2979ff;--red:#ff4757;--green:#00e676;
  --font-ui:'Inter',sans-serif;--font-code:'JetBrains Mono',monospace;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
  margin:0;background:var(--bg);color:#ccc;
  font-family:var(--font-ui);height:100vh;
  display:flex;flex-direction:column;overflow:hidden
}
#master-scroll{flex:1;overflow-y:auto;padding-bottom:80px}
header{
  position:sticky;top:0;z-index:100;
  background:#050505;border-bottom:1px solid var(--border);
  padding:15px 25px;display:flex;
  justify-content:space-between;align-items:center
}
.brand{font-size:1.1rem;font-weight:900;color:#fff}
.brand span{color:var(--gold)}
.status-pill{
  background:#111;border:1px solid #333;
  padding:6px 12px;border-radius:4px;
  font-family:var(--font-code);font-size:.6rem;
  color:var(--green);display:flex;gap:6px;align-items:center
}
.dot{width:6px;height:6px;border-radius:50%;background:var(--green)}
.dot.off{background:var(--red)}
.zone{padding:30px;border-bottom:1px dashed #222}
.zone-title{
  font-size:.7rem;font-weight:900;
  color:#666;margin-bottom:15px;
  text-transform:uppercase;letter-spacing:1px
}
.ingest-box{
  width:100%;height:200px;
  background:#080808;border:1px solid #333;
  border-radius:12px;padding:20px;
  font-family:var(--font-code);font-size:.7rem;
  color:var(--blue);resize:none;
  white-space:pre;overflow:auto
}
.action-bar{display:flex;gap:15px;margin-top:20px}
.btn-pill{
  background:var(--gold);color:#000;border:none;
  padding:12px 30px;border-radius:50px;
  font-weight:900;font-size:.8rem;cursor:pointer
}
.btn-ghost{
  background:transparent;border:1px solid #444;
  color:#888;padding:10px 20px;
  border-radius:50px;font-weight:700;font-size:.7rem
}
.terminal{
  background:#000;border:1px solid #222;
  border-radius:8px;padding:15px;
  font-family:var(--font-code);font-size:.7rem;
  height:120px;overflow-y:auto;margin-top:15px
}
.log-entry{margin-bottom:4px}
.log-success{color:var(--green)}
.log-err{color:var(--red)}
.modal-overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.95);
  z-index:2000;display:none;
  align-items:center;justify-content:center
}
.modal-box{
  width:90%;max-width:500px;
  background:#111;border:1px solid #333;
  padding:25px;border-radius:12px
}
.modal-header{font-weight:900;color:var(--red)}
.surgeon-input{
  width:100%;height:120px;
  background:#000;border:1px solid var(--red);
  color:#fff;padding:15px;
  font-family:var(--font-code);font-size:.75rem
}
</style>
</head>

<body>

<header>
  <div class="brand">VIA.<span>STACK</span> LAB</div>
  <div class="status-pill">
    <div class="dot" id="db-dot"></div>
    <span id="db-text">DB READY</span>
  </div>
</header>

<div id="master-scroll">

<div class="zone">
  <div class="zone-title">01 // INGESTION (25-COL)</div>
  <textarea id="raw-input" class="ingest-box"></textarea>
  <div class="action-bar">
    <button class="btn-pill" onclick="initiateAlignment()">INITIATE ALIGNMENT</button>
    <button class="btn-ghost" onclick="raw.value=''">CLEAR</button>
  </div>
  <div class="terminal" id="console-log"></div>
</div>

</div>

<div id="surgeon-modal" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-header">SURGICAL INTERVENTION</div>
    <p id="surgeon-msg"></p>
    <textarea id="surgeon-input" class="surgeon-input"></textarea>
    <div class="action-bar" style="justify-content:flex-end">
      <button class="btn-ghost" onclick="discardRow()">SKIP</button>
      <button class="btn-pill" onclick="sutureRow()">SUTURE</button>
    </div>
  </div>
</div>

<script>
let RAW_LINES=[],FAULTY_ROW_INDEX=-1;
const EXPECTED_COLS=25;

function log(msg,type=''){
  const c=document.getElementById('console-log');
  c.innerHTML=`<div class="log-entry log-${type}">> ${msg}</div>`+c.innerHTML;
}

function initiateAlignment(){
  RAW_LINES=document.getElementById('raw-input').value
    .split('\n')
    .filter(l=>l.trim()!=='');
  runGatekeeper();
}

function runGatekeeper(){
  for(let i=0;i<RAW_LINES.length;i++){
    const cols=RAW_LINES[i].split('\t');
    if(cols.length<24||cols.length>25){
      FAULTY_ROW_INDEX=i;
      document.getElementById('surgeon-msg').innerText=
        `ROW ${i+1} HAS ${cols.length} COLUMNS`;
      document.getElementById('surgeon-input').value=RAW_LINES[i];
      document.getElementById('surgeon-modal').style.display='flex';
      return;
    }
  }
  log(`ALIGNMENT COMPLETE: ${RAW_LINES.length} ROWS`,`success`);
}

function discardRow(){
  RAW_LINES.splice(FAULTY_ROW_INDEX,1);
  document.getElementById('surgeon-modal').style.display='none';
  setTimeout(runGatekeeper,0);
}

/* =======================
   ðŸ”§ FINAL FIX IS HERE
   ======================= */
function sutureRow(){
  let fixed=document.getElementById('surgeon-input').value;

  fixed=fixed
    .replace(/\r?\n/g,'')        // kill mobile line breaks
    .replace(/ {2,}/g,'\t')      // spaces â†’ tabs
    .replace(/\t+/g,'\t')        // collapse tabs
    .trim();

  RAW_LINES[FAULTY_ROW_INDEX]=fixed;

  document.getElementById('surgeon-modal').style.display='none';

  setTimeout(runGatekeeper,0);
}
</script>

</body>
</html>
