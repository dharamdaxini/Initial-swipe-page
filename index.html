<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Alchemist V81.35 - Validated Intent</title>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Outfit:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
<style>
/* --- LOCKED TO V81.4 UI ENGINE --- */
:root { --bg: #000; --card: #111; --gold: #ffd600; --blue: #3498db; --serif: 'Libre Baskerville', serif; --ui: 'Outfit', sans-serif; --code: 'JetBrains Mono', monospace; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { margin: 0; height: 100vh; background: var(--bg); color: #fff; font-family: var(--ui); overflow: hidden; touch-action: none; }

#header { width: 90%; margin: calc(20px + env(safe-area-inset-top)) auto 0; z-index: 100; }
.header-meta { display: flex; justify-content: space-between; font-family: var(--code); font-size: 0.75rem; color: #555; margin-bottom: 8px; }
.progress-track { width: 100%; height: 4px; background: #222; border-radius: 2px; overflow: hidden; }
#progress-bar { height: 100%; background: var(--gold); width: 0%; transition: width 0.4s ease; }

#stack { position: relative; width: 92%; max-width: 400px; height: calc(100vh - 180px - env(safe-area-inset-top)); margin: 25px auto 0; perspective: 1200px; }
.card { position: absolute; width: 100%; height: 100%; background: var(--card); border-radius: 40px; border: 1px solid #282828; padding: 30px; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 20px 60px rgba(0,0,0,0.9); transform-origin: center center; will-change: transform; z-index: 1; }

.card-q { font-family: var(--serif); font-size: clamp(1.2rem, 4.5vw, 1.7rem); line-height: 1.4; font-weight: 700; text-align: center; color: #f0f0f0; pointer-events: none; transition: transform 0.25s cubic-bezier(0.19, 1, 0.22, 1); will-change: transform; z-index: 5; }

.swipe-label { position: absolute; inset: 0; display: none; align-items: center; justify-content: center; background: transparent; z-index: 2000; pointer-events: none; }
.sl-dn { flex-direction: column !important; justify-content: center !important; }

/* BULB ORIGIN - 1000198193.jpg */
.sl-down-emoji { font-size: 4.5rem; display: none; opacity: 0; transition: filter 0.1s, opacity 0.2s; will-change: filter, transform, opacity; margin-top: 20px; z-index: 6; }

.context-wrap { width: 100%; padding: 0 15px; opacity: 0; transition: opacity 0.3s ease; position: absolute; top: 50%; left: 0; transform: translateY(-50%); z-index: 4; }
.context-wrap.active { opacity: 1; }

.study-header { font-size: 0.75rem; color: var(--gold); font-family: var(--code); margin-bottom: 12px; letter-spacing: 2px; font-weight: 900; text-align: center; }
.bullet-list { list-style: none; padding: 0; margin: 0; text-align: left; }
.bullet-item { font-size: 1.15rem; line-height: 1.6; color: #eee; font-family: var(--serif); margin-bottom: 12px; position: relative; padding-left: 25px; }
.bullet-item::before { content: "â€¢"; position: absolute; left: 0; color: var(--gold); font-size: 1.4rem; }

#loader { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.5rem; letter-spacing: 4px; color: var(--gold); }
</style>
</head>
<body>

<div id="loader">ALCHEMIST V81.35</div>
<div id="header">
    <div class="header-meta"><span>RANK: NOVICE</span><span id="xp-ui">0 XP</span></div>
    <div class="progress-track"><div id="progress-bar"></div></div>
</div>

<div id="stack">
    <div id="sl-up" class="swipe-label" style="background: rgba(0,0,0,0.95);">UP</div>
    <div id="sl-lt" class="swipe-label" style="background: rgba(0,0,0,0.95);">LEFT</div>
    <div id="sl-rt" class="swipe-label" style="background: rgba(0,0,0,0.95);">RIGHT</div>
    <div id="sl-dn" class="swipe-label">
        <div id="context-mount" class="context-wrap">
            <div class="study-header">CONTEXT</div>
            <ul id="bullet-mount" class="bullet-list"></ul>
        </div>
        <span id="bulb-element" class="sl-down-emoji">ðŸ’¡</span>
    </div>
</div>

<script>
const DATABASE = [{ "q": "What does a negative Î”G value signify?", "u": "Spontaneous", "r": "Equilibrium", "l": "Non-Spont", "c": "UP", "bullets": ["Naturally rolls down a slope", "Releases potential energy", "Needs no external push"] }];
let POOL = [], SCORE = 0, isTransitioning = false;

// CONFIDENCE STATE: null = No data registered
let confidenceRating = null; 

const CM_0_5 = 16;  // Bulb Visible
const CM_1_0 = 32;  // Lift Starts + CONFIDENCE STARTS
const CM_3_0 = 96;  // Unlock
const MAX_Y_PX = 160;

const format = t => t.toString().replace(/([A-Z][a-z]?)(\d+)/g,'$1<sub>$2</sub>').replace(/(\d*)([+\-])/g, '<sup>$1$2</sup>').replace(/Î”/g, '&Delta;');

function init(){ POOL = [...DATABASE]; setTimeout(() => { document.getElementById('loader').remove(); renderNext(); }, 1000); }

function renderNext(){
    const s = document.getElementById('stack');
    const existing = s.querySelector('.card'); if(existing) existing.remove();
    if(!POOL.length){ s.innerHTML = `<div class="card"><div class="card-q">COMPLETE</div></div>`; return; }
    const q = POOL.shift();
    const c = document.createElement('div'); c.className = "card";
    c.innerHTML = `<div class="card-q">${format(q.q)}</div>`;
    s.appendChild(c); 
    document.getElementById('sl-up').innerText = q.u;
    document.getElementById('sl-lt').innerText = q.l;
    document.getElementById('sl-rt').innerText = q.r;
    document.getElementById('bullet-mount').innerHTML = q.bullets.map(b => `<li class="bullet-item">${format(b)}</li>`).join('');
    bindPhysics(c, q);
}

function bindPhysics(el, qData){
    let sx=0, sy=0, active=false, dir=null, finalDist=0;
    const labels = { up: document.getElementById('sl-up'), dn: document.getElementById('sl-dn'), lt: document.getElementById('sl-lt'), rt: document.getElementById('sl-rt') };
    const bulb = document.getElementById('bulb-element');
    const wrap = document.getElementById('context-mount');
    const queText = el.querySelector('.card-q');

    const start = e => { if(isTransitioning) return; active=true; const p=e.touches?e.touches[0]:e; sx=p.clientX; sy=p.clientY; el.style.transition="none"; queText.style.transition="none"; bulb.style.transition="none"; };
    
    const move = e => {
        if(!active) return; const p=e.touches?e.touches[0]:e;
        const dx = p.clientX - sx, dy = p.clientY - sy;
        finalDist = Math.sqrt(dx*dx + dy*dy);
        let ang = Math.atan2(-dy, dx) * (180 / Math.PI); if(ang<0) ang+=360;

        Object.values(labels).forEach(l => { l.style.display = 'none'; l.style.opacity = 0; });

        if(finalDist > 5){
            if(ang>=45&&ang<135) dir="UP"; else if(ang>=135&&ang<225) dir="LEFT"; else if(ang>=225&&ang<315) dir="DOWN"; else dir="RIGHT";
        }

        let cardX = (dir === "DOWN") ? 0 : dx;
        let cardY = (dir === "DOWN") ? 0 : dy;
        el.style.transform = `translate3d(${cardX}px, ${cardY}px, 0) rotate(${dir === "DOWN" ? 0 : dx/25}deg)`;

        if(dir === "DOWN"){
            labels.dn.style.display = 'flex';
            labels.dn.style.opacity = Math.min(finalDist / 24, 1);

            // BULB APPEARANCE (0.5cm)
            if(finalDist >= CM_0_5) { bulb.style.display = 'block'; bulb.style.opacity = 1; } 
            else { bulb.style.display = 'block'; bulb.style.opacity = finalDist / CM_0_5; }

            // RIFT + CONFIDENCE START (1.0cm)
            if(finalDist >= CM_1_0) {
                const liftProg = Math.min((finalDist - CM_1_0) / 64, 1);
                queText.style.transform = `translateY(-${liftProg * MAX_Y_PX}px)`;
                bulb.style.transform = `translateY(${liftProg * 40}px)`;
                
                // Initialize confidence tracking only here
                if(confidenceRating === null) confidenceRating = "High"; 
            } else {
                queText.style.transform = `translateY(0)`;
                bulb.style.transform = `translateY(0)`;
            }

            // UNLOCK (3.0cm)
            if(finalDist >= CM_3_0) {
                wrap.classList.add('active');
                bulb.style.filter = `drop-shadow(0 0 30px var(--gold)) brightness(2)`;
                confidenceRating = "Low"; // Intent validated as low confidence
            } else {
                wrap.classList.remove('active');
                bulb.style.filter = 'none';
            }
        }
    };

    const end = () => {
        if(!active) return; active = false;
        if(dir === "DOWN" && finalDist < CM_3_0){
            queText.style.transition = "transform .2s"; queText.style.transform = `translateY(0)`;
            bulb.style.transition = "transform .2s, opacity .2s"; bulb.style.transform = `translateY(0)`; bulb.style.opacity = 0;
            el.style.transition = "transform .2s"; el.style.transform = "translate(0,0)";
        } else if(dir && finalDist >= 32){
            isTransitioning = true;
            el.style.transition = "transform .4s ease-in"; el.style.transform = `translate3d(${dir==="LEFT"?-400:400}px, ${dir==="UP"?-400:400}px, 0)`;
            
            // LOGGING: Only award bonus if lift occurred
            if(dir === qData.c.toUpperCase()) {
                if(confidenceRating === "High") SCORE += 15; // Lifted but didn't view
                else SCORE += 10;
            }
            
            setTimeout(() => { isTransitioning = false; confidenceRating = null; renderNext(); updateUI(); }, 300);
        } else {
            el.style.transition = "transform .2s"; el.style.transform = "translate(0,0)";
            queText.style.transform = `translateY(0)`;
            confidenceRating = null; // Reset if release occurred before trigger
        }
        Object.values(labels).forEach(l => { if(l !== labels.dn || finalDist < CM_3_0) l.style.display = 'none'; });
    };
    el.ontouchstart=start; el.ontouchmove=move; el.ontouchend=end;
}
function updateUI(){ document.getElementById('xp-ui').innerText = `${SCORE} XP`; document.getElementById('progress-bar').style.width = `${(SCORE % 100)}%`; }
window.onload = init;
</script>
</body>
</html>
