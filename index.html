<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Alchemist V77.1 Master</title>
    <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Outfit:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #000; --card: #111; --gold: #ffd600; --border: #222;
            --serif: 'Libre Baskerville', serif; --ui: 'Outfit', sans-serif; --code: 'JetBrains Mono', monospace;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; height: 100vh; background: var(--bg); color: #fff; font-family: var(--ui); overflow: hidden; touch-action: none; }

        /* V77.1 HEADER */
        #header { width: 92%; margin: 30px auto 0; position: relative; z-index: 100; }
        .header-meta { 
            display: flex; justify-content: space-between;
            font-family: var(--code); font-size: 0.75rem; color: #444; 
            letter-spacing: 2px; text-transform: uppercase; font-weight: 900; 
        }

        /* THE V77.1 STACK */
        #stack { position: relative; width: 92%; max-width: 420px; height: 75vh; margin: 25px auto 0; perspective: 1500px; }
        
        .card { 
            position: absolute; width: 100%; height: 100%; background: var(--card); border-radius: 32px; border: 1px solid var(--border); 
            padding: 40px 25px; display: flex; flex-direction: column; justify-content: center; z-index: 5; 
            box-shadow: 0 40px 80px rgba(0,0,0,0.8);
            transition: filter 0.4s ease, opacity 0.4s ease, transform 0.3s cubic-bezier(0.19, 1, 0.22, 1); 
        }

        /* V77.1 RIFT PHYSICS (RECESSED SCALE) */
        .card.study-active { filter: blur(20px) brightness(0.2); opacity: 0.5; transform: scale(0.85) translateY(40px); pointer-events: none; }
        .card-q { font-family: var(--serif); font-size: 1.65rem; line-height: 1.5; font-weight: 700; text-align: center; color: #fff; }

        /* STUDY DRAWER (ANALYSIS) */
        .study-drawer { 
            position: absolute; inset: 0; padding: 40px 20px; z-index: 10; display: flex; flex-direction: column; 
            opacity: 0; visibility: hidden; transform: translateY(20px); transition: all 0.5s ease; 
        }
        .study-drawer.active { opacity: 1; visibility: visible; transform: translateY(0); }
        
        .meta-label { font-family: var(--code); font-size: 0.65rem; color: #555; letter-spacing: 4px; margin-bottom: 25px; text-transform: uppercase; }
        
        /* OPTION GRID (V77.1 STACKED) */
        .option-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 20px; }
        .opt-item { 
            font-size: 1rem; padding: 14px; background: #080808; border: 1px solid #1a1a1a; border-radius: 12px;
            font-family: var(--serif); color: #ccc; display: flex; align-items: center; transition: 0.1s;
        }
        .opt-item span { font-family: var(--code); color: var(--gold); font-size: 0.65rem; margin-right: 15px; font-weight: 900; }
        .opt-item:active { background: var(--gold); color: #000; }

        .explanation-text { 
            font-size: 1.25rem; line-height: 1.5; color: var(--gold); font-family: var(--serif); font-style: italic; 
            border-top: 1px solid #222; padding-top: 20px; margin-top: auto; 
        }

        #loader { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; font-weight: 900; color: var(--gold); letter-spacing: 5px; }
    </style>
</head>
<body>

<div id="loader">ALCHEMIST V77.1</div>

<div id="header">
    <div class="header-meta"><span id="category-ui">BOOT</span><span id="id-ui">V77.1</span></div>
</div>

<div id="stack">
    <div id="study-drawer" class="study-drawer">
        <div class="meta-label" id="hint-ui">HINT: READY</div>
        <div class="option-grid">
            <div class="opt-item" onclick="submit('UP')"><span>UP</span><div id="opt-up"></div></div>
            <div class="opt-item" onclick="submit('RIGHT')"><span>RIGHT</span><div id="opt-right"></div></div>
            <div class="opt-item" onclick="submit('LEFT')"><span>LEFT</span><div id="opt-left"></div></div>
        </div>
        <div id="explanation-mount" class="explanation-text"></div>
    </div>
</div>

<script>
    /* --- CONFIG --- */
    var DEPLOY_URL = "https://script.google.com/macros/s/AKfycbxMOVzmONXP6nAHNoN92nmO2MnMPek7omYcw0JCeizbsIOQZUik0VmUK0nTfikIfFLm/exec";

    /* --- INDUSTRIAL DATASET --- */
    var DATASET = [
      { "id": "SET_A_0301", "set": "SET_A", "category": "Gas Laws", "question": "The ideal gas constant R has the same value regardless of gas identity.", "option_up": "Depends on gas type", "option_right": "Universal constant", "option_left": "Changes with pressure", "correct_option": "option_right", "explanation": "R does not vary with gas identity. It is a universal constant for ideal gases.", "hint": "Universal constant.", "weight": 0.34 },
      { "id": "SET_A_0302", "set": "SET_A", "category": "Gas Laws", "question": "At constant volume an increase in temperature increases pressure.", "option_up": "Pressure decreases", "option_right": "Pressure remains same", "option_left": "Pressure increases", "correct_option": "option_left", "explanation": "Higher temperature increases molecular collisions, raising pressure.", "hint": "Gay-Lussac.", "weight": 0.36 },
      { "id": "SET_A_0303", "set": "SET_A", "category": "Gas Laws", "question": "Absolute temperature must be used in gas law calculations.", "option_up": "Celsius scale acceptable", "option_right": "Only Fahrenheit works", "option_left": "Temperature in Kelvin", "correct_option": "option_left", "explanation": "Kelvin scale reflects absolute temperature.", "hint": "Absolute scale.", "weight": 0.31 }
      /* ... Rest of your 50 JSON objects go here ... */
    ];

    var POOL = DATASET.slice();
    var sy = 0, isLocked = false, startTime = 0, latency = 0;

    function init() { 
        setTimeout(function() { 
            var l = document.getElementById('loader');
            if(l) l.remove();
            render(); 
        }, 1000); 
    }

    function render() {
        var s = document.getElementById('stack');
        var existing = s.querySelector('.card');
        if(existing) existing.remove();
        
        if(!POOL.length) { 
            s.innerHTML = '<div class="card"><div class="card-q" style="color:#ffd600">STAY HUNGRY</div></div>'; 
            return; 
        }
        
        var d = POOL[0];
        var card = document.createElement('div');
        card.className = "card";
        card.innerHTML = '<div class="card-q">' + d.question + '</div>';
        s.appendChild(card);
        
        document.getElementById('category-ui').innerText = d.category;
        document.getElementById('id-ui').innerText = d.id;
        document.getElementById('hint-ui').innerText = "HINT: " + d.hint;
        document.getElementById('opt-up').innerText = d.option_up;
        document.getElementById('opt-right').innerText = d.option_right;
        document.getElementById('opt-left').innerText = d.option_left;
        document.getElementById('explanation-mount').innerText = d.explanation;

        document.getElementById('study-drawer').classList.remove('active');
        isLocked = false;
        bindPhysics(card);
    }

    function bindPhysics(el) {
        el.ontouchstart = function(e) { sy = e.touches[0].clientY; startTime = Date.now(); el.style.transition = "none"; };
        el.ontouchmove = function(e) {
            var dy = e.touches[0].clientY - sy;
            if(!isLocked && dy > 110) { 
                isLocked = true;
                latency = Date.now() - startTime;
                document.getElementById('study-drawer').classList.add('active');
                el.classList.add('study-active');
            }
            if(!isLocked && dy > 0) el.style.transform = "translateY(" + (dy * 0.22) + "px)";
        };
        el.ontouchend = function(e) {
            if(!isLocked) { el.style.transition = "transform 0.4s cubic-bezier(0.19, 1, 0.22, 1)"; el.style.transform = "translateY(0)"; }
        };
    }

    function submit(choice) {
        var d = POOL[0];
        var correct = (("option_" + choice.toLowerCase()) === d.correct_option);
        
        // GHOST PIXEL SUBMISSION (CONNECTED TO BACKEND)
        var ping = DEPLOY_URL + "?target=Telemetry" + 
                   "&questionId=" + encodeURIComponent(d.id) + 
                   "&result=" + correct + 
                   "&vectorChoice=" + choice + 
                   "&latency=" + latency + 
                   "&weight=" + d.weight;
        new Image().src = ping;

        // V77.1 EJECT ANIMATION
        var card = document.querySelector('.card');
        if(card) {
            card.style.transition = "transform 0.4s ease-in, opacity 0.4s";
            card.style.transform = "translateY(-700px)";
            card.style.opacity = "0";
        }

        setTimeout(function() { POOL.shift(); render(); }, 400);
    }

    window.onload = init;
</script>
</body>
</html>
