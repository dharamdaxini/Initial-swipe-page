<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Alchemist V81.16 - Abstract Motion</title>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Outfit:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
<style>
/* --- LOCKED TO V81.4 UI ENGINE --- */
:root { --bg: #000; --card: #111; --gold: #ffd600; --blue: #3498db; --serif: 'Libre Baskerville', serif; --ui: 'Outfit', sans-serif; --code: 'JetBrains Mono', monospace; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { margin: 0; height: 100vh; background: var(--bg); color: #fff; font-family: var(--ui); overflow: hidden; touch-action: none; }

#header { width: 90%; margin: calc(20px + env(safe-area-inset-top)) auto 0; z-index: 100; }
.header-meta { display: flex; justify-content: space-between; font-family: var(--code); font-size: 0.75rem; color: #555; margin-bottom: 8px; }
.progress-track { width: 100%; height: 4px; background: #222; border-radius: 2px; overflow: hidden; }
#progress-bar { height: 100%; background: var(--gold); width: 0%; transition: width 0.4s ease; }

#stack { position: relative; width: 92%; max-width: 400px; height: calc(100vh - 180px - env(safe-area-inset-top)); margin: 25px auto 0; perspective: 1200px; }
.card { position: absolute; width: 100%; height: 100%; background: var(--card); border-radius: 40px; border: 1px solid #282828; padding: 30px; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 20px 60px rgba(0,0,0,0.9); transform-origin: center center; will-change: transform; z-index: 1; }
.card-q { font-family: var(--serif); font-size: clamp(1.2rem, 4.5vw, 1.7rem); line-height: 1.4; font-weight: 700; text-align: center; color: #f0f0f0; pointer-events: none; }

/* AXIS-LOCKED LABELS - OUTSIDE CARD */
.swipe-label { position: absolute; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,0.92); color: #fff; font-weight: 900; font-size: 1.8rem; text-transform: uppercase; border-radius: 40px; z-index: 2000; text-align: center; padding: 20px; will-change: transform, opacity; pointer-events: none; }
.sl-dn { flex-direction: column !important; }
.sl-down-emoji { font-size: 4rem; margin-bottom: 15px; display: block; }
.sl-down-hint-text { color: var(--blue) !important; font-size: 1.1rem; text-transform: none; font-family: var(--serif); font-weight: 400; line-height: 1.4; max-width: 80%; margin: 0 auto; }

/* STUDY OVERLAY */
.overlay { position: absolute; inset: 0; background: #000; z-index: 3000; padding: 20px; opacity: 0; pointer-events: none; border-radius: 40px; display: none; flex-direction: column; justify-content: space-between; }
.overlay.active { opacity: 1; display: flex; pointer-events: auto; }
.study-container { width: 100%; height: 60vh; overflow: hidden; position: relative; margin-top: 10px; }
.study-track { display: flex; width: 300%; height: 100%; transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
.study-slide { width: 33.333%; height: 100%; flex-shrink: 0; padding: 0 10px; overflow-y: auto; -webkit-overflow-scrolling: touch; }
.study-header { font-size: 0.7rem; color: var(--gold); font-family: var(--code); margin-bottom: 10px; letter-spacing: 2px; font-weight: 900; text-transform: uppercase; }
.study-body { font-size: 1.05rem; line-height: 1.6; color: #ccc; font-family: var(--serif); padding-bottom: 30px; }
.study-nav { display: flex; justify-content: center; margin-bottom: 15px; gap: 8px; }
.nav-dot { width: 7px; height: 7px; border-radius: 50%; background: #333; }
.nav-dot.active { background: var(--gold); }
.btn { width: 100%; padding: 18px; border-radius: 100px; border: none; background: #fff; color: #000; font-weight: 900; cursor: pointer; text-transform: uppercase; font-family: var(--ui); }

#loader { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.5rem; letter-spacing: 4px; color: var(--gold); }
sub { font-size: 0.7em; vertical-align: sub; line-height: 0; }
sup { font-size: 0.7em; vertical-align: super; line-height: 0; }
</style>
</head>
<body>

<div id="loader">ALCHEMIST V81.16</div>
<div id="header">
    <div class="header-meta"><span>RANK: NOVICE</span><span id="xp-ui">0 XP</span></div>
    <div class="progress-track"><div id="progress-bar"></div></div>
</div>

<div id="stack">
    <div id="sl-up" class="swipe-label">UP</div>
    <div id="sl-lt" class="swipe-label">LEFT</div>
    <div id="sl-rt" class="swipe-label">RIGHT</div>
    <div id="sl-dn" class="swipe-label">
        <span class="sl-down-emoji">ðŸ’¡</span>
        <span id="hint-text-mount" class="sl-down-hint-text"></span>
    </div>
</div>

<script>
const DATABASE = [
  { "q": "What does a negative Î”G value signify?", "h": "Think about energy release vs requirement.", "u": "Spontaneous", "r": "Equilibrium", "l": "Non-Spont", "c": "UP", "s1": "âŒ Positive Î”G requires energy input. || âœ… Negative Î”G confirms the system releases free energy naturally.", "s2": "Imagine a ball on a slope. It naturally rolls down to lower potential energy.", "s3": "Mathematically, negative sign = thermodynamically favorable." }
];

let POOL = [], SCORE = 0, isTransitioning = false;
const CLAMP = 32, OPACITY = 24;

const format = t => {
    if(!t) return "";
    return t.toString().replace(/([A-Z][a-z]?)(\d+)/g,'$1<sub>$2</sub>').replace(/(\d*)([+\-])/g, '<sup>$1$2</sup>').replace(/\|\|/g, '<br><br>').replace(/Î”/g, '&Delta;');
};

function init(){
    POOL = [...DATABASE];
    setTimeout(() => { document.getElementById('loader').remove(); renderNext(); }, 1000);
}

function renderNext(){
    const s = document.getElementById('stack');
    const existingCard = s.querySelector('.card');
    if(existingCard) existingCard.remove();
    
    if(!POOL.length){ s.innerHTML = `<div class="card"><div class="card-q">COMPLETE<br>${SCORE} XP</div><button class="btn" onclick="location.reload()">REPLAY</button></div>`; return; }
    
    const q = POOL.shift();
    const c = document.createElement('div'); c.className = "card";
    c.innerHTML = `
        <div class="card-q">${format(q.q)}</div>
        <div class="overlay">
            <div class="study-container">
                <div class="study-track">
                    <div class="study-slide"><div class="study-header">1. INSIGHTS</div><div class="study-body">${format(q.s1)}</div></div>
                    <div class="study-slide"><div class="study-header">2. CONTEXT</div><div class="study-body">${format(q.s2)}</div></div>
                    <div class="study-slide"><div class="study-header">3. JUDGMENT</div><div class="study-body">${format(q.s3)}</div></div>
                </div>
            </div>
            <div class="study-nav"><div class="nav-dot active"></div><div class="nav-dot"></div><div class="nav-dot"></div></div>
            <button class="btn" onclick="closeOverlay(this)">CONTINUE</button>
        </div>
    `;
    s.appendChild(c); 
    document.getElementById('sl-up').innerText = q.u;
    document.getElementById('sl-lt').innerText = q.l;
    document.getElementById('sl-rt').innerText = q.r;
    document.getElementById('hint-text-mount').innerText = q.h;

    bindMainPhysics(c, q);
}

function bindMainPhysics(el, qData){
    let sx=0, sy=0, active=false, dir=null;
    const labels = { up: document.getElementById('sl-up'), dn: document.getElementById('sl-dn'), lt: document.getElementById('sl-lt'), rt: document.getElementById('sl-rt') };

    const start = e => { if(isTransitioning || el.querySelector('.overlay').classList.contains('active')) return; active=true; const p=e.touches?e.touches[0]:e; sx=p.clientX; sy=p.clientY; el.style.transition="none"; };
    
    const move = e => {
        if(!active) return; const p=e.touches?e.touches[0]:e;
        const dx = p.clientX - sx, dy = p.clientY - sy, dist = Math.sqrt(dx*dx + dy*dy);
        const op = Math.min(dist / OPACITY, 1);
        
        // UNIT CIRCLE METHOD - BACKEND PROCESS
        let ang = Math.atan2(-dy, dx) * (180 / Math.PI); if(ang<0) ang+=360;
        
        Object.values(labels).forEach(l => { l.style.display = 'none'; l.style.opacity = 0; });

        if(dist > 5){
            let target = null;
            // 4-SECTOR MAPPING
            if(ang>=45&&ang<135) { target = labels.up; target.style.transform = `translate3d(0, ${dy}px, 0)`; dir="UP"; }
            else if(ang>=135&&ang<225) { target = labels.lt; target.style.transform = `translate3d(${dx}px, 0, 0)`; dir="LEFT"; }
            else if(ang>=225&&ang<315) { target = labels.dn; target.style.transform = `translate3d(0, ${dy}px, 0)`; dir="DOWN"; }
            else { target = labels.rt; target.style.transform = `translate3d(${dx}px, 0, 0)`; dir="RIGHT"; }
            
            if(target) { target.style.display = 'flex'; target.style.opacity = op; }
            if(dist < CLAMP) dir = null; // Lock trigger to Unit Circle distance
        }

        el.style.transform = `translate3d(${dx}px, ${dy}px, 0) rotate(${dx/25}deg)`;
    };

    const end = () => {
        if(!active) return; active = false;
        if(dir === "DOWN"){ 
            const ov = el.querySelector('.overlay'); ov.classList.add('active');
            bindOverlayPhysics(ov);
            el.style.transition = "transform .3s"; el.style.transform = "translate3d(0,0,0) rotate(0deg)"; 
        } else if(dir){
            isTransitioning = true;
            el.style.transition = "transform .4s ease-in"; el.style.transform = `translate3d(${dir==="LEFT"?-400:400}px, ${dir==="UP"?-400:400}px, 0)`;
            if(dir === qData.c.toUpperCase()) SCORE += 10;
            setTimeout(() => { isTransitioning = false; renderNext(); updateUI(); }, 300);
        } else { el.style.transition = "transform .2s"; el.style.transform = "translate3d(0,0,0) rotate(0deg)"; }
        Object.values(labels).forEach(l => { l.style.display = 'none'; });
    };
    el.onmousedown=start; window.onmousemove=move; window.onmouseup=end; el.ontouchstart=start; el.ontouchmove=move; el.ontouchend=end;
}

function bindOverlayPhysics(ov) {
    const track = ov.querySelector('.study-track');
    const dots = ov.querySelectorAll('.nav-dot');
    let curr = 0, sx = 0, dx = 0;
    track.ontouchstart = e => { sx = e.touches[0].clientX; dx = 0; };
    track.ontouchmove = e => { dx = e.touches[0].clientX - sx; };
    track.ontouchend = () => {
        if (Math.abs(dx) > 60) {
            if (dx < 0 && curr < 2) curr++; else if (dx > 0 && curr > 0) curr--;
            track.style.transform = `translateX(-${curr * 33.333}%)`;
            dots.forEach((d, i) => d.classList.toggle('active', i === curr));
        }
    };
}

function closeOverlay(btn) { btn.parentElement.classList.remove('active'); }
function updateUI(){ document.getElementById('xp-ui').innerText = `${SCORE} XP`; document.getElementById('progress-bar').style.width = `${(SCORE % 100)}%`; }
window.onload = init;
</script>
</body>
</html>
