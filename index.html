<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#09090b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Strategic Convergence 2026</title>

    <style>
        /* 1. ASSETS */
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Inter:wght@400;600;800;900&display=swap');

        /* 2. DESIGN TOKENS */
        :root {
            /* Core Palette */
            --bg-void: #050505;
            --bg-panel: rgba(24, 24, 27, 0.6); /* Glass effect base */
            --bg-card: #ffffff;
            
            /* Typography */
            --font-display: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --text-primary: #ffffff;
            --text-secondary: #a1a1aa;
            --text-card: #09090b;

            /* Signals (Swipe Colors) */
            --signal-up: #4ade80;    /* Neon Green */
            --signal-down: #f87171;  /* Soft Red */
            --signal-left: #94a3b8;  /* Cool Grey */
            --signal-right: #facc15; /* Bright Gold */

            /* Physics */
            --card-width: 90%;
            --card-max-width: 400px;
            --header-h: 120px;
            --footer-h: 180px;
        }

        /* 3. RESET & BASE */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0; padding: 0;
            -webkit-tap-highlight-color: transparent;
            touch-action: none; /* LOCK SCROLL */
            user-select: none; -webkit-user-select: none;
        }

        body {
            background-color: var(--bg-void);
            color: var(--text-primary);
            font-family: var(--font-display);
            height: 100svh; width: 100vw;
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        /* 4. APP SHELL (The Device Container) */
        #app-shell {
            position: relative;
            width: 100%; height: 100%;
            max-width: 450px; /* Desktop Constraint */
            max-height: 950px;
            display: flex; flex-direction: column;
            background: var(--bg-void);
            box-shadow: 0 0 100px rgba(0,0,0,0.8);
            overflow: hidden;
        }

        /* 5. DYNAMIC BACKGROUND (The Dot Grid) */
        #ui-grid-bg {
            position: absolute;
            inset: 0;
            background-image: 
                radial-gradient(circle, #27272a 1px, transparent 1px);
            background-size: 24px 24px;
            opacity: 0.3;
            z-index: 0;
            pointer-events: none;
        }
        
        #ui-color-overlay {
            position: absolute; inset: 0;
            background: transparent;
            opacity: 0;
            z-index: 1;
            transition: opacity 0.1s linear;
            pointer-events: none;
        }

        /* 6. GLASS HEADER */
        .glass-panel {
            background: var(--bg-panel);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            z-index: 50;
        }

        .header {
            height: var(--header-h);
            display: flex; flex-direction: column;
            justify-content: flex-end; align-items: center;
            padding-bottom: 1.5rem;
            position: relative;
        }

        .progress-bar {
            position: absolute; top: 0; left: 0;
            height: 3px; width: 0%;
            background: var(--signal-up);
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--signal-up);
        }

        .meta-tag {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            letter-spacing: 0.15em;
            background: rgba(255,255,255,0.05);
            padding: 4px 8px;
            border-radius: 4px;
        }

        .meta-title {
            font-size: 1.25rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* 7. CARD STACK (The Stage) */
        .stage {
            flex: 1;
            position: relative;
            display: flex; justify-content: center; align-items: center;
            perspective: 1200px;
            z-index: 10;
        }

        .card {
            position: absolute;
            width: var(--card-width);
            max-width: var(--card-max-width);
            aspect-ratio: 1/1.15;
            background: var(--bg-card);
            border-radius: 32px;
            box-shadow: 0 20px 50px -10px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 2.5rem;
            text-align: center;
            
            /* GPU Hardware Acceleration */
            will-change: transform, opacity;
            transform-style: preserve-3d;
            backface-visibility: hidden;
            
            /* Center Anchor Logic */
            top: 50%; left: 50%;
            margin-top: -60%; margin-left: -45%;
        }

        .card-text {
            font-size: 1.6rem; /* Large readable text */
            font-weight: 700;
            line-height: 1.35;
            color: var(--text-card);
            pointer-events: none;
        }

        .card-id {
            position: absolute; bottom: 2rem;
            font-family: var(--font-mono);
            font-size: 0.6rem;
            color: #d4d4d8;
            pointer-events: none;
        }

        /* 8. GLASS FOOTER (Controls) */
        .footer {
            height: var(--footer-h);
            display: grid;
            grid-template-columns: 1fr 90px 1fr;
            grid-template-rows: 1fr 1fr;
            align-content: center; justify-items: center;
            border-top: 1px solid rgba(255,255,255,0.05);
            padding-bottom: 2rem;
            z-index: 50;
        }

        .ctrl {
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            color: rgba(255,255,255,0.3);
            transition: transform 0.1s linear, color 0.1s linear;
        }

        /* Active Glow State */
        .ctrl.active {
            color: #fff;
            text-shadow: 0 0 15px currentColor;
            transform: scale(1.3);
        }

        .ctrl.up { grid-column: 2; grid-row: 1; margin-bottom: 0.5rem; }
        .ctrl.down { grid-column: 2; grid-row: 2; margin-top: 0.5rem; }
        .ctrl.left { grid-column: 1; grid-row: 2; }
        .ctrl.right { grid-column: 3; grid-row: 2; }

        .icon { font-size: 2.2rem; display: block; line-height: 1; margin-bottom: 4px; }
        .label { font-family: var(--font-mono); font-size: 0.6rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; }

        /* 9. VIEWS (Start/Summary) */
        .view {
            position: absolute; inset: 0;
            background: var(--bg-void);
            z-index: 100;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 2rem;
            opacity: 0; pointer-events: none;
            transition: opacity 0.4s ease;
        }
        .view.active { opacity: 1; pointer-events: auto; }

        .btn-hero {
            background: #fff; color: #000;
            border: none; padding: 1.2rem 3rem;
            font-size: 1rem; font-weight: 800;
            border-radius: 100px; cursor: pointer;
            box-shadow: 0 0 30px rgba(255,255,255,0.2);
            transition: transform 0.1s;
        }
        .btn-hero:active { transform: scale(0.96); }

        .stat-grid { display: flex; gap: 2rem; margin-bottom: 3rem; }
        .stat-box { text-align: center; }
        .stat-val { font-size: 3.5rem; font-weight: 900; line-height: 1; display: block; }
        .stat-lbl { font-family: var(--font-mono); font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; }

        /* Utils */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="app-shell">
        <div id="ui-grid-bg"></div>
        <div id="ui-color-overlay"></div>

        <section id="view-start" class="view active">
            <div style="font-family:'JetBrains Mono'; font-size:0.7rem; color:var(--signal-up); border:1px solid var(--signal-up); padding:4px 8px; border-radius:4px; margin-bottom:1.5rem;">V3.1 // SECURE</div>
            <h1 style="font-size:3.5rem; font-weight:900; line-height:0.9; margin-bottom:1.5rem; text-align:center; letter-spacing:-0.05em;">STRATEGIC<br>CONVERGENCE</h1>
            <p style="color:var(--text-secondary); text-align:center; max-width:280px; margin-bottom:3rem; line-height:1.6;">
                Operator Assessment.<br>30 Questions.<br>Swipe to Execute.
            </p>
            <button class="btn-hero" onclick="APP.start()">INITIATE</button>
        </section>

        <section id="view-game" class="view" style="justify-content:flex-start; padding:0; background:transparent;">
            
            <header class="header glass-panel">
                <div class="progress-bar" id="ui-progress"></div>
                <span class="meta-tag" id="ui-topic">TOPIC</span>
                <span class="meta-title" id="ui-type">TYPE</span>
            </header>

            <div class="stage" id="card-stack">
                </div>

            <footer class="footer glass-panel" id="ui-footer">
                <div class="ctrl up">
                    <span class="icon">↑</span>
                    <span class="label" id="lbl-up">True</span>
                </div>
                <div class="ctrl left">
                    <span class="icon">←</span>
                    <span class="label" id="lbl-left">Skip</span>
                </div>
                <div class="ctrl down">
                    <span class="icon">↓</span>
                    <span class="label" id="lbl-down">False</span>
                </div>
                <div class="ctrl right">
                    <span class="icon">→</span>
                    <span class="label" id="lbl-right">Unsure</span>
                </div>
            </footer>
        </section>

        <section id="view-summary" class="view">
            <h2 class="meta-title" style="margin-bottom:3rem;">MISSION REPORT</h2>
            <div class="stat-grid">
                <div class="stat-box">
                    <span class="stat-val" id="res-score">0</span>
                    <span class="stat-lbl">Points</span>
                </div>
                <div class="stat-box">
                    <span class="stat-val" id="res-acc">0%</span>
                    <span class="stat-lbl">Accuracy</span>
                </div>
            </div>
            <p style="color:var(--text-secondary); font-family:var(--font-mono); font-size:0.8rem; margin-bottom:3rem;">DATA SYNC COMPLETE</p>
            <button class="btn-hero" onclick="location.reload()">REBOOT</button>
        </section>

    </div>

    <script>
        /* --- CONFIGURATION --- */
        const CONFIG = {
            API_URL: "https://script.google.com/macros/s/AKfycbz_ziu5Dezrz35J2FksQtNEYuZ5Kk6TrQvg3pM5O5eBYUDzWCCtqlGWwZj8D-TBQLFw/exec",
            THRESHOLD: 75, // Drag distance to trigger swipe
            COLORS: { 
                UP: '#4ade80',    // Green
                DOWN: '#f87171',  // Red
                RIGHT: '#facc15', // Gold
                LEFT: '#94a3b8'   // Grey
            }
        };

        /* --- BALANCED QUESTION BANK (Easy/Med/Hard) --- */
        const QUESTIONS = [
            // EASY
            { id: "e1", topic: "Geography", type: "FACT", text: "IMEC corridor connects India to Europe via the Middle East.", up:"True", down:"False", right:"Unsure", left:"Skip", correct:"up", w:1 },
            { id: "e2", topic: "Energy", type: "FACT", text: "India committed to Net Zero emissions by 2050.", up:"True", down:"False", right:"2070", left:"Skip", correct:"right", w:1 },
            // MEDIUM
            { id: "m1", topic: "Semiconductors", type: "CONTEXT", text: "Micron's Gujarat plant is for ATMP packaging, not full fabrication.", up:"True", down:"False", right:"Fab", left:"Skip", correct:"up", w:2 },
            { id: "m2", topic: "Space", type: "REASONING", text: "Gaganyaan delay was primarily due to launch vehicle unavailability.", up:"True", down:"False", right:"Safety", left:"Skip", correct:"right", w:2 },
            // HARD
            { id: "h1", topic: "Trade", type: "TRAP", text: "India finalized a full FTA with the UK in Jan 2026.", up:"Signed", down:"Stalled", right:"Draft", left:"Skip", correct:"right", w:3 }
        ];

        /* --- APP CONTROLLER --- */
        const APP = {
            deck: [], idx: 0, answers: {}, activeCard: null,

            start() {
                this.deck = [...QUESTIONS]; // Optional: .sort(() => Math.random() - 0.5) for shuffle
                document.getElementById('view-start').classList.remove('active');
                document.getElementById('view-game').classList.add('active');
                this.render();
            },

            render() {
                const stack = document.getElementById('card-stack');
                stack.innerHTML = '';
                
                // End Game Check
                if(this.idx >= this.deck.length) return this.finish();

                // Render Strategy: Draw next 2 cards (Active + Background)
                const buffer = this.deck.slice(this.idx, this.idx + 2).reverse();
                
                buffer.forEach((q, i) => {
                    const realIdx = this.idx + (buffer.length - 1 - i);
                    const el = document.createElement('div');
                    el.className = 'card';
                    
                    if (realIdx === this.idx) {
                        // Top Card
                        el.style.zIndex = 100;
                        this.activeCard = el;
                        PHYSICS.bind(el); // Attach Touch Logic
                    } else {
                        // Background Card
                        el.style.zIndex = 90;
                        el.style.transform = 'scale(0.95) translateY(15px)';
                        el.style.opacity = 0.6;
                    }

                    el.innerHTML = `
                        <p class="card-text">${q.text}</p>
                        <div class="card-id">ID: ${q.id}</div>
                    `;
                    stack.appendChild(el);
                });

                this.updateUI();
            },

            updateUI() {
                const q = this.deck[this.idx];
                document.getElementById('ui-topic').textContent = q.topic;
                document.getElementById('ui-type').textContent = q.type;
                document.getElementById('ui-progress').style.width = `${(this.idx / this.deck.length) * 100}%`;
                
                document.getElementById('lbl-up').textContent = q.up;
                document.getElementById('lbl-down').textContent = q.down;
                document.getElementById('lbl-left').textContent = q.left;
                document.getElementById('lbl-right').textContent = q.right;
            },

            finish() {
                document.getElementById('view-game').classList.remove('active');
                document.getElementById('view-summary').classList.add('active');
                
                const score = Object.values(this.answers).reduce((a, b) => a + b.score, 0);
                const count = Object.values(this.answers).filter(a => a.correct).length;
                const acc = Math.round((count / this.deck.length) * 100);

                document.getElementById('res-score').textContent = score;
                document.getElementById('res-acc').textContent = acc + "%";

                // Sync to Sheets
                fetch(CONFIG.API_URL, {
                    method:'POST', mode:'no-cors', headers:{'Content-Type':'text/plain'},
                    body: JSON.stringify({ answers: this.answers, score: score, timestamp: new Date().toISOString() })
                });
            }
        };

        /* --- PHYSICS ENGINE (Touch & Visuals) --- */
        const PHYSICS = {
            el: null, startX: 0, startY: 0, dragging: false,
            overlay: document.getElementById('ui-color-overlay'),
            
            bind(el) {
                this.el = el;
                el.addEventListener('touchstart', this.start.bind(this), {passive:false});
                el.addEventListener('mousedown', this.start.bind(this));
            },

            start(e) {
                this.dragging = true;
                const p = e.touches ? e.touches[0] : e;
                this.startX = p.clientX; this.startY = p.clientY;
                this.el.style.transition = 'none'; // Remove lag
                
                // Bind Window listeners to catch "slip"
                window.addEventListener('touchmove', this.move.bind(this), {passive:false});
                window.addEventListener('mousemove', this.move.bind(this));
                window.addEventListener('touchend', this.end.bind(this));
                window.addEventListener('mouseup', this.end.bind(this));
            },

            move(e) {
                if(!this.dragging) return;
                if(e.cancelable) e.preventDefault(); // Stop Scroll
                
                const p = e.touches ? e.touches[0] : e;
                const dx = p.clientX - this.startX;
                const dy = p.clientY - this.startY;
                
                // 1. Move Card
                this.el.style.transform = `translate(${dx}px, ${dy}px) rotate(${dx * 0.05}deg)`;
                
                // 2. Visual Feedback (Glow + Icons)
                this.feedback(dx, dy);
            },

            end(e) {
                if(!this.dragging) return;
                this.dragging = false;
                
                // Cleanup
                window.removeEventListener('touchmove', this.move.bind(this));
                window.removeEventListener('mousemove', this.move.bind(this));
                window.removeEventListener('touchend', this.end.bind(this));
                window.removeEventListener('mouseup', this.end.bind(this));

                // Calculate Release
                const p = e.changedTouches ? e.changedTouches[0] : e;
                const dx = p.clientX - this.startX;
                const dy = p.clientY - this.startY;
                
                // Logic Threshold
                if (Math.abs(dy) > CONFIG.THRESHOLD && Math.abs(dy) > Math.abs(dx)) {
                    this.commit(dy < 0 ? 'up' : 'down');
                } else if (Math.abs(dx) > CONFIG.THRESHOLD) {
                    this.commit(dx > 0 ? 'right' : 'left');
                } else {
                    this.reset();
                }
            },

            feedback(dx, dy) {
                const ax = Math.abs(dx); const ay = Math.abs(dy);
                let color = ''; let cls = '';

                // Determine dominant axis
                if (ay > ax) { 
                    color = dy < 0 ? CONFIG.COLORS.UP : CONFIG.COLORS.DOWN; 
                    cls = dy < 0 ? 'up' : 'down'; 
                } else { 
                    color = dx > 0 ? CONFIG.COLORS.RIGHT : CONFIG.COLORS.LEFT; 
                    cls = dx > 0 ? 'right' : 'left'; 
                }

                const intensity = Math.min(Math.max(ax, ay) / CONFIG.THRESHOLD, 1);

                // Background Fade
                this.overlay.style.backgroundColor = color;
                this.overlay.style.opacity = intensity * 0.4; // Subtle tint

                // Icon Scale
                document.querySelectorAll('.ctrl').forEach(el => el.classList.remove('active'));
                if (intensity > 0.3) {
                    document.querySelector(`.ctrl.${cls}`).classList.add('active');
                    // Inject color to active icon
                    document.querySelector(`.ctrl.${cls}`).style.color = color;
                } else {
                    // Reset colors if drag is weak
                    document.querySelectorAll('.ctrl').forEach(el => el.style.color = '');
                }
            },

            reset() {
                this.el.style.transition = 'transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                this.el.style.transform = 'translate(0,0) rotate(0)';
                this.overlay.style.opacity = 0;
                document.querySelectorAll('.ctrl').forEach(el => {
                    el.classList.remove('active');
                    el.style.color = '';
                });
            },

            commit(dir) {
                const q = APP.deck[APP.idx];
                
                // Scoring
                const isCorrect = (dir === q.correct);
                const score = isCorrect ? (10 * q.w) : (dir === 'left' ? 0 : -5);
                APP.answers[q.id] = { dir, score, correct: isCorrect };

                // Fly Away Vectors
                let tx=0, ty=0; const d=1000;
                if(dir==='up') ty=-d; if(dir==='down') ty=d; if(dir==='left') tx=-d; if(dir==='right') tx=d;

                this.el.style.transition = 'transform 0.3s ease-in';
                this.el.style.transform = `translate(${tx}px, ${ty}px) rotate(${tx * 0.1}deg)`;
                
                // Reset Visuals
                this.overlay.style.opacity = 0;
                document.querySelectorAll('.ctrl').forEach(el => {
                    el.classList.remove('active');
                    el.style.color = '';
                });

                setTimeout(() => {
                    this.el.remove();
                    APP.idx++;
                    APP.render();
                }, 300);
            }
        };

        // --- GLOBAL BOOTSTRAP ---
        // Prevent scroll on body to lock the app
        document.addEventListener('touchmove', e => e.preventDefault(), { passive: false });

    </script>
</body>
</html>
