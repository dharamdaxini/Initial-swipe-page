<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Alchemist V81.7 - Insight Build</title>
<link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Outfit:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
<style>
:root { --bg: #000; --card: #111; --gold: #ffd600; --blue: #3498db; --ui-font: 'Outfit', sans-serif; --serif: 'Libre Baskerville', serif; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { margin: 0; height: 100vh; background: var(--bg); color: #fff; font-family: var(--ui-font); overflow: hidden; touch-action: none; }

#header { width: 90%; margin: calc(20px + env(safe-area-inset-top)) auto 0; z-index: 100; pointer-events: none; }
.header-meta { display: flex; justify-content: space-between; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: #555; margin-bottom: 8px; }
.progress-track { width: 100%; height: 4px; background: #222; border-radius: 2px; }
#progress-bar { height: 100%; background: var(--gold); width: 0%; transition: width 0.4s ease; }

#stack { position: relative; width: 92%; max-width: 400px; height: calc(100vh - 160px - env(safe-area-inset-top)); margin: 25px auto 0; perspective: 1200px; }
.card { position: absolute; width: 100%; height: 100%; background: var(--card); border-radius: 40px; border: 1px solid #282828; padding: 30px; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 20px 60px rgba(0,0,0,0.9); will-change: transform; cursor: grab; }
.card-q { font-family: var(--serif); font-size: clamp(1.2rem, 4.5vw, 1.7rem); line-height: 1.4; text-align: center; color: #f0f0f0; }

.swipe-label { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.96); font-weight: 900; font-size: 1.8rem; text-transform: uppercase; border-radius: 40px; z-index: 999; opacity: 0; pointer-events: none; padding: 30px; text-align: center; }

/* V81.7 HINT LAYOUT */
.sl-dn { flex-direction: column !important; }
.sl-down-emoji { font-size: 3rem; margin-bottom: 12px; display: block; }
.sl-down-hint-text { color: var(--blue); font-size: 1.1rem; text-transform: none; font-family: var(--serif); font-weight: 400; line-height: 1.4; max-width: 80%; }

.overlay { position: absolute; inset: 0; background: #0d0d0d; z-index: 1100; padding: 30px; opacity: 0; pointer-events: none; border-radius: 40px; display: flex; flex-direction: column; justify-content: center; transition: opacity 0.2s; }
.overlay.active { opacity: 1; pointer-events: auto; }
.overlay-body { font-size: 1rem; line-height: 1.5; color: #ccc; margin-bottom: 25px; font-family: var(--serif); }
.btn { width: 100%; padding: 18px; border-radius: 100px; border: none; background: #fff; color: #000; font-weight: 900; cursor: pointer; text-transform: uppercase; }

#loader { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.5rem; letter-spacing: 4px; color: var(--gold); }
</style>
</head>
<body>
<div id="loader">ALCHEMIST V81.7</div>
<div id="header"><div class="header-meta"><span>RANK: NOVICE</span><span id="xp-ui">0 XP</span></div><div class="progress-track"><div id="progress-bar"></div></div></div>
<div id="stack"></div>

<script>
const DATABASE = [
  { "dataset": "SET_A", "topic": "Physical", "q_type": "CONCEPT", "question_text": "What does a negative Î”G value signify?", "hint": "Think about whether the system requires energy or releases it.", "explanation": "âœ… Negative Î”G: Spontaneous. âŒ Positive Î”G: Non-spontaneous.", "swipe_up_label": "Spontaneous", "swipe_right_label": "Equilibrium", "swipe_left_label": "Non-Spont", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Physical", "q_type": "APPLICATION", "question_text": "If rate doubles with +10K, effect on rate constant k?", "hint": "Review the exponential relationship in the Arrhenius equation.", "explanation": "âœ… k increases exponentially with temperature. It is never constant.", "swipe_up_label": "k Increases", "swipe_right_label": "k is Constant", "swipe_left_label": "k Decreases", "correct": "UP", "weight": 2 },
  { "dataset": "SET_A", "topic": "Organic", "q_type": "CONCEPT", "question_text": "What defines a chiral carbon?", "hint": "Check for any internal planes of symmetry or identical groups.", "explanation": "âœ… Chiral carbons must be bonded to 4 unique substituents.", "swipe_up_label": "4 Groups", "swipe_right_label": "Symmetry", "swipe_left_label": "Double Bonds", "correct": "UP", "weight": 1 }
];

let POOL = [...DATABASE], SCORE = 0, isTransitioning = false;
const CLAMP = 32, OPACITY = 24;

const format = t => {
    if(!t) return "";
    return t.toString().replace(/([A-Z][a-z]?)(\d+)/g,'$1<sub>$2</sub>').replace(/(\d*)([+\-])/g, '<sup>$1$2</sup>').replace(/\|\|/g, '<br><br>').replace(/Î”/g, '&Delta;');
};

function init(){
    POOL = POOL.sort(() => Math.random() - 0.5);
    setTimeout(() => { document.getElementById('loader').remove(); renderNext(); }, 1000);
}

function renderNext(){
    const s = document.getElementById('stack'); s.innerHTML = "";
    if(!POOL.length){ s.innerHTML = `<div class="card"><div class="card-q">MASTERED<br>${SCORE} XP</div><button class="btn" onclick="location.reload()">REPLAY</button></div>`; return; }
    const q = POOL.shift();
    const c = document.createElement('div'); c.className = "card";
    c.innerHTML = `
        <div class="card-q">${format(q.question_text)}</div>
        <div class="swipe-label sl-up">${format(q.swipe_up_label)}</div>
        <div class="swipe-label sl-lt">${format(q.swipe_left_label)}</div>
        <div class="swipe-label sl-rt">${format(q.swipe_right_label)}</div>
        <div class="swipe-label sl-dn">
            <span class="sl-down-emoji">ðŸ’¡</span>
            <span class="sl-down-hint-text">${format(q.hint)}</span>
        </div>
        <div class="overlay"><div style="color:var(--gold); font-size:0.7rem; margin-bottom:10px; letter-spacing:2px;">LOGIC ANALYSIS</div><div class="overlay-body">${format(q.explanation)}</div><button class="btn" onclick="this.parentElement.classList.remove('active')">CONTINUE</button></div>
    `;
    s.appendChild(c); bindPhysics(c, q);
}

function bindPhysics(el, data){
    let sx=0, sy=0, active=false, dir=null;
    const labels = { up: el.querySelector('.sl-up'), dn: el.querySelector('.sl-dn'), lt: el.querySelector('.sl-lt'), rt: el.querySelector('.sl-rt') };
    const start = e => { if(isTransitioning || el.querySelector('.overlay').classList.contains('active')) return; active=true; const p=e.touches?e.touches[0]:e; sx=p.clientX; sy=p.clientY; el.style.transition="none"; };
    const move = e => {
        if(!active) return; const p=e.touches?e.touches[0]:e;
        const dx = p.clientX - sx, dy = p.clientY - sy, dist = Math.sqrt(dx*dx + dy*dy);
        const op = Math.min(dist / OPACITY, 1);
        let ang = Math.atan2(-dy, dx) * (180 / Math.PI); if(ang<0) ang+=360;
        Object.values(labels).forEach(l => { if(l) l.style.opacity = 0; });
        if(dist > 5){
            if(ang>=45&&ang<135) labels.up.style.opacity = op;
            else if(ang>=135&&ang<225) labels.lt.style.opacity = op;
            else if(ang>=225&&ang<315) labels.dn.style.opacity = op;
            else labels.rt.style.opacity = op;
        }
        el.style.transform = `translate3d(${Math.min(dist, CLAMP) * (dx/dist || 0)}px, ${Math.min(dist, CLAMP) * (dy/dist || 0)}px, 0) rotate(${dx/25}deg)`;
        dir = (dist >= CLAMP) ? (ang>=45&&ang<135?"UP":ang>=135&&ang<225?"LEFT":ang>=225&&ang<315?"DOWN":"RIGHT") : null;
    };
    const end = () => {
        if(!active) return; active = false;
        if(dir === "DOWN"){ el.querySelector('.overlay').classList.add('active'); el.style.transition = "transform .3s"; el.style.transform = "translate3d(0,0,0) rotate(0deg)"; }
        else if(dir){
            isTransitioning = true; if(dir === data.correct.toUpperCase()) SCORE += (10 * (data.weight || 1));
            el.style.transition = "transform .4s ease-in"; el.style.transform = `translate3d(${dir==="LEFT"?-400:400}px, ${dir==="UP"?-400:400}px, 0)`;
            setTimeout(() => { el.remove(); isTransitioning = false; renderNext(); updateUI(); }, 300);
        } else { el.style.transition = "transform .2s"; el.style.transform = "translate3d(0,0,0) rotate(0deg)"; }
        Object.values(labels).forEach(l => { if(l) l.style.opacity = 0; });
    };
    el.onmousedown=start; window.onmousemove=move; window.onmouseup=end; el.ontouchstart=start; el.ontouchmove=move; el.ontouchend=end;
}
function updateUI(){ document.getElementById('xp-ui').innerText = `${SCORE} XP`; document.getElementById('progress-bar').style.width = `${(SCORE % 100)}%`; }
window.onload = init;
</script>
</body>
</html>
