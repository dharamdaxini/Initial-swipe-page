<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Alchemist V133.27-H | Operator Interface</title>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,600;1,600&family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000; --card: #111; --border: #222; --gold: #ffd600; --blue: #3498db;
            --font-book: 'Crimson Text', serif; 
            --font-ui: 'Inter', sans-serif; 
            --font-mono: 'JetBrains Mono', monospace; 
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; -webkit-font-smoothing: antialiased; }
        body { margin: 0; height: 100vh; background: var(--bg); color: #fff; font-family: var(--font-ui); overflow: hidden; touch-action: none; display: flex; flex-direction: column; }
        sub { font-size: 0.75em; vertical-align: sub; line-height: 0; }
        sup { font-size: 0.75em; vertical-align: super; line-height: 0; }
        #header { width: 90%; margin: 25px auto 0; z-index: 100; flex-shrink: 0; }
        .header-meta { display: flex; justify-content: space-between; font-family: var(--font-mono); font-size: 0.7rem; color: #555; letter-spacing: 2px; }
        .progress-track { width: 100%; height: 2px; background: #1a1a1a; margin-top: 10px; overflow: hidden; }
        #progress-bar { height: 100%; background: var(--gold); width: 0%; transition: width 0.4s ease; }
        #stack { position: relative; width: 92%; max-width: 400px; height: 70vh; margin: auto; perspective: 1200px; display: flex; align-items: center; justify-content: center; }
        .card { position: absolute; width: 100%; height: 95%; background: var(--card); border-radius: 40px; border: 1px solid var(--border); padding: 40px; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 30px 90px rgba(0,0,0,0.9); will-change: transform; transform: translate3d(0,0,0); }
        .card.study-active { filter: blur(20px) brightness(0.2); opacity: 0.5; transform: scale(0.85) translateY(40px) !important; pointer-events: none; }
        .card-q { font-family: var(--font-book); font-size: 1.7rem; line-height: 1.4; font-style: italic; font-weight: 600; text-align: center; }
        .swipe-label { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: #000; color: #fff; font-weight: 900; font-size: 1.8rem; text-transform: uppercase; border-radius: 40px; z-index: 999; opacity: 0; pointer-events: none; text-align: center; padding: 20px; font-family: var(--font-ui); }
        .overlay { position: absolute; inset: 0; background: #0d0d0d; z-index: 1100; padding: 40px; opacity: 0; pointer-events: none; border-radius: 40px; transition: opacity 0.3s ease; display: flex; flex-direction: column; justify-content: center; overflow-y: auto;}
        .overlay.active { opacity: 1; pointer-events: auto; }
        .overlay-body { font-size: 1.1rem; line-height: 1.6; color: #bbb; margin-bottom: 30px; font-family: var(--font-book); }
        .btn { width: 100%; padding: 18px; border-radius: 50px; border: none; background: #fff; color: #000; font-weight: 900; text-transform: uppercase; cursor: pointer; font-family: var(--font-ui); }
        #loader { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; font-family: var(--font-mono); color: var(--gold); letter-spacing: 5px; }
    </style>
</head>
<body>
<div id="loader">SYSTEM SYNC...</div>
<div id="header"><div class="header-meta"><span id="id-ui">ID: BOOT</span><span id="xp-ui">0 XP</span></div><div class="progress-track"><div id="progress-bar"></div></div></div>
<div id="stack"></div>
<script>
    /* --- FINAL BACKEND LOGIC --- */
    class TextFormatter {
        static parse(text) {
            if(!text) return '';
            return text.toString()
                .replace(/\|\|/g, '<br><br>') 
                .replace(/(\d+)([+\-])/g, '<sup>$1$2</sup>')
                .replace(/([A-Z][a-z]?)(\d+)/g, '$1<sub>$2</sub>') 
                .replace(/\^([\-\d]+)/g, '<sup>$1</sup>') 
                .replace(/Delta/g, '&Delta;');
        }
    }

    const SYS = { DB_KEY: 'ALCHEMIST_MASTER_DB', PROGRESS_KEY: 'ALCH_V133_XP', PHYSICS: { SWIPE_THRESHOLD: 100, ROTATION_FACTOR: 20, ANIM_DURATION: 400 } };
    
    // ... [Original Physics and Session Bridge code remains identical] ...

    /* Logic: Bridge new 25-col DB to original UX */
    async function Boot() {
        const db = JSON.parse(localStorage.getItem(SYS.DB_KEY) || '[]');
        document.getElementById('loader').style.display = 'none';
        if(db.length > 0) Start(db);
    }

    function Start(pool) {
        if(pool.length === 0) return;
        const d = pool[0];
        document.getElementById('id-ui').innerText = d.id;
        const el = document.createElement('div'); el.className = 'card';
        el.innerHTML = `<div class="card-q">${TextFormatter.parse(d.q)}</div><div class="swipe-label sl-up">${TextFormatter.parse(d.u)}</div><div class="swipe-label sl-left">${TextFormatter.parse(d.l)}</div><div class="swipe-label sl-right">${TextFormatter.parse(d.r)}</div><div class="swipe-label sl-down">HINT</div><div class="overlay"><div class="overlay-body">${TextFormatter.parse(d.logic)}</div><button class="btn" onclick="location.reload()">RESUME</button></div>`;
        document.getElementById('stack').appendChild(el);
        // [Physics initialization]
    }
    window.onload = Boot;
</script>
</body>
</html>
