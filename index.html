<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#09090b">
<title>Chemistry Master V22</title>

<style>
/* ===== UI: UNCHANGED (SOURCE OF TRUTH) ===== */
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&family=Inter:wght@400;600;800&display=swap');

:root{
--bg-void:#050505;--bg-card:#ffffff;--text-main:#18181b;--text-sub:#71717a;--accent:#3b82f6;
--green:#22c55e;--red:#ef4444;--yellow:#eab308;--grey:#64748b;
--card-w:88vw;--card-max:360px;
}

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;touch-action:none;user-select:none;-webkit-tap-highlight-color:transparent}
body{
background:var(--bg-void);color:#f4f4f5;font-family:'Inter',sans-serif;
height:100svh;width:100vw;overflow:hidden;display:flex;justify-content:center;align-items:center;
}

#app-shell{position:relative;width:100%;height:100%;max-width:480px;display:flex;flex-direction:column;background:var(--bg-void);overflow:hidden}
#ui-overlay{position:absolute;inset:0;opacity:0;pointer-events:none;transition:.1s;z-index:5}

.header{height:15%;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;padding-bottom:1.5rem}
.progress-bar{width:60px;height:4px;background:#27272a;border-radius:10px;margin-bottom:.75rem;overflow:hidden}
.progress-fill{height:100%;background:#fff;width:0%;transition:.3s}
.meta-tag{font-family:'JetBrains Mono';font-size:.7rem;color:var(--text-sub);letter-spacing:.1em}
.meta-title{font-size:1.1rem;font-weight:800;color:#fff;letter-spacing:.05em}

.stage{flex:1;position:relative;perspective:1000px}
.card{
position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
width:var(--card-w);max-width:var(--card-max);aspect-ratio:3/4.2;
background:var(--bg-card);border-radius:24px;box-shadow:0 20px 40px -5px rgba(0,0,0,.3);
display:flex;flex-direction:column;justify-content:center;align-items:center;
padding:2rem;text-align:center;will-change:transform
}
.card.context-card{background:#18181b;border:1px solid #27272a}
.card.context-card p{color:#fff}
.card p{font-size:1.4rem;font-weight:800;color:var(--text-main);margin-bottom:1.5rem}

.card-list{width:100%;padding-left:1.2rem}
.card-list li{list-style:none;font-size:.95rem;color:var(--text-sub);margin-bottom:.75rem;position:relative}
.card-list li::before{content:"•";color:var(--accent);position:absolute;left:-1.2rem;font-size:1.5rem}

.card-id{position:absolute;bottom:1.5rem;font-family:'JetBrains Mono';font-size:.6rem;color:#d4d4d8}

.footer{
height:20%;display:grid;grid-template-columns:1fr 80px 1fr;grid-template-rows:1fr 1fr;
align-content:center;justify-items:center
}
.ctrl{display:flex;flex-direction:column;align-items:center;color:#52525b;transition:.15s}
.ctrl.active{color:#fff;transform:scale(1.2)}
.icon{font-size:1.8rem}
.label{font-size:.65rem;font-weight:700;letter-spacing:.1em}

.view{position:absolute;inset:0;display:flex;flex-direction:column;justify-content:center;align-items:center;opacity:0;pointer-events:none}
.view.active{opacity:1;pointer-events:auto}

.btn-main{background:#fff;color:#000;border:none;padding:1rem 3rem;border-radius:100px;font-weight:800}
.hidden{display:none!important}
#status-bar{position:absolute;bottom:10px;right:10px;font-size:10px;color:#333}
</style>
</head>

<body>
<div id="app-shell">
<div id="ui-overlay"></div>

<section id="view-start" class="view active">
<h1 style="font-size:3rem;font-weight:800;color:#fff">CHEMISTRY<br>MASTER</h1>
<button class="btn-main" onclick="APP.start('CORE')">START QUIZ</button>
</section>

<section id="view-game" class="view">
<header class="header">
<div class="progress-bar"><div class="progress-fill" id="ui-progress"></div></div>
<span class="meta-tag" id="ui-topic"></span>
<span class="meta-title" id="ui-type"></span>
</header>
<div class="stage" id="card-stack"></div>
<footer class="footer">
<div class="ctrl up"><span class="icon">↑</span><span class="label" id="lbl-up">TRUE</span></div>
<div class="ctrl left"><span class="icon">←</span><span class="label" id="lbl-left">CONTEXT</span></div>
<div class="ctrl down"><span class="icon">↓</span><span class="label" id="lbl-down">FALSE</span></div>
<div class="ctrl right"><span class="icon">→</span><span class="label" id="lbl-right">UNSURE</span></div>
</footer>
</section>

<div id="status-bar">Sync Ready</div>
</div>

<script>
/* ===== BACKEND: REBUILT, UI-NEUTRAL ===== */

const GOOGLE_SCRIPT_URL =
"https://script.google.com/macros/s/AKfycbxW-via-zE7FWqGKNZsilySBncR3I_lLOXK83P8tymRLoi50VaSWNr7J4vHa8R2DRwE/exec";

const CONFIG={THRESHOLD:75};

const DECKS={
CORE:[
{id:"c1",topic:"Structure",type:"ATOM",text:"Protons and Neutrons reside in the nucleus.",correct:"up",w:1},
{id:"c2",topic:"Charge",type:"ATOM",text:"An electron carries a positive electrical charge.",correct:"down",w:1},
{id:"c3",topic:"Identity",type:"ATOM",text:"Changing proton count changes the element.",correct:"up",w:1}
]
};

const APP={
deck:[],idx:0,answers:{},el:null,

start(key){
this.deck=[...(DECKS[key]||[])];
this.idx=0;this.answers={};
document.getElementById('view-start').classList.remove('active');
document.getElementById('view-game').classList.add('active');
this.render();
},

render(){
const stack=document.getElementById('card-stack');stack.innerHTML='';
if(this.idx>=this.deck.length)return;
const q=this.deck[this.idx];
const el=document.createElement('div');
el.className='card';
el.innerHTML=`<p>${q.text}</p><div class="card-id">${q.id}</div>`;
stack.appendChild(el);
this.el=el;
this.bindPointer(el);

document.getElementById('ui-topic').textContent=q.topic;
document.getElementById('ui-type').textContent=q.type;
document.getElementById('ui-progress').style.width=`${(this.idx/this.deck.length)*100}%`;
},

bindPointer(el){
let sx=0,sy=0,drag=false;
el.onpointerdown=e=>{
drag=true;sx=e.clientX;sy=e.clientY;
el.setPointerCapture(e.pointerId);
};
el.onpointermove=e=>{
if(!drag)return;
const dx=e.clientX-sx,dy=e.clientY-sy;
el.style.transform=`translate(-50%,-50%) translate(${dx}px,${dy}px) rotate(${dx*0.05}deg)`;
};
el.onpointerup=e=>{
if(!drag)return;drag=false;
const dx=e.clientX-sx,dy=e.clientY-sy;
let dir=null;
if(Math.abs(dy)>CONFIG.THRESHOLD&&Math.abs(dy)>Math.abs(dx))dir=dy<0?'up':'down';
else if(Math.abs(dx)>CONFIG.THRESHOLD)dir=dx>0?'right':'left';
this.commit(dir);
};
},

commit(dir){
const q=this.deck[this.idx];
this.answers[q.id]={dir,correct:dir===q.correct,ts:Date.now()};
this.sync(q,dir);
this.idx++;
this.render();
},

sync(q,dir){
fetch(GOOGLE_SCRIPT_URL,{
method:'POST',mode:'no-cors',
body:JSON.stringify({id:q.id,topic:q.topic,dir,correct:dir===q.correct,ts:new Date().toISOString()})
});
}
};
</script>
</body>
</html>
