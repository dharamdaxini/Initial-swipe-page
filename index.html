<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<meta name="theme-color" content="#050505" />
<title>Swipe Master — Live Sheet Engine</title>

<!-- FREE, OPEN SOURCES ONLY -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#050505;--card:#ffffff;--text:#18181b;--muted:#71717a;
  --up:#22c55e;--down:#ef4444;--left:#64748b;--right:#eab308;
}
*{box-sizing:border-box;margin:0;padding:0;user-select:none;-webkit-tap-highlight-color:transparent}
body{
  background:var(--bg);font-family:Inter,system-ui;height:100svh;overflow:hidden;
  display:flex;align-items:center;justify-content:center;color:#fff
}
#app{width:100%;max-width:420px;height:100%;position:relative}
header{padding:20px;text-align:center}
header small{font-family:JetBrains Mono;color:var(--muted);letter-spacing:.2em}
header h1{font-size:1.1rem;font-weight:800;margin-top:4px}

#stage{position:relative;flex:1;height:70%;perspective:1000px}
.card{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:86%;max-width:360px;aspect-ratio:3/4.2;
  background:var(--card);border-radius:22px;
  display:flex;flex-direction:column;justify-content:center;
  padding:24px;text-align:center;color:var(--text);
  box-shadow:0 20px 40px rgba(0,0,0,.35)
}
.card.context{background:#1f2937;color:#fff;border:2px solid #3b82f6}
.card p{font-size:1.3rem;font-weight:800}
.card ul{margin-top:14px;text-align:left}
.card li{font-size:.9rem;color:var(--muted);margin-bottom:6px}

footer{
  height:20%;display:grid;grid-template-columns:1fr 80px 1fr;
  grid-template-rows:1fr 1fr;align-items:center;justify-items:center
}
.ctrl{font-size:.65rem;letter-spacing:.15em;color:#52525b;text-align:center}
.ctrl b{display:block;font-size:1.6rem}

#overlay{position:absolute;inset:0;pointer-events:none;opacity:0}

.hidden{display:none}
</style>
</head>

<body>
<div id="app">
  <header>
    <small>BONDING</small>
    <h1 id="topic">LIVE</h1>
  </header>

  <div id="stage"></div>

  <footer>
    <div class="ctrl" id="btn-up"><b>↑</b><span id="lbl-up">UP</span></div>
    <div class="ctrl" id="btn-left"><b>←</b><span id="lbl-left">DEEP DIVE</span></div>
    <div class="ctrl" id="btn-down"><b>↓</b><span id="lbl-down">DOWN</span></div>
    <div class="ctrl" id="btn-right"><b>→</b><span id="lbl-right">UNSURE</span></div>
  </footer>

  <div id="overlay"></div>
</div>

<script>
/* =========================================================
   LIVE GOOGLE APPS SCRIPT — DEPLOYMENT ID HARD-PASTED
   ========================================================= */
const GOOGLE_SCRIPT_URL =
  "https://script.google.com/macros/s/AKfycbxW-via-zE7FWqGKNZsilySBncR3I_lLOXK83P8tymRLoi50VaSWNr7J4vHa8R2DRwE/exec";

/* =========================================================
   ENGINE STATE
   ========================================================= */
let deck=[], idx=0, active=null, startX=0, startY=0;

/* =========================================================
   FETCH + NORMALIZE
   ========================================================= */
fetch(GOOGLE_SCRIPT_URL)
.then(r=>r.json())
.then(rows=>{
  deck = rows.filter(r=>r.active===true);
  render();
});

/* =========================================================
   RENDER
   ========================================================= */
function render(){
  if(idx>=deck.length) return;
  const q = deck[idx];
  document.getElementById("topic").textContent = q.topic || "QUIZ";

  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`<p>${q.question_text}</p>`;
  active=c;
  bind(c,q);
  const s=document.getElementById("stage");
  s.innerHTML="";
  s.appendChild(c);

  document.getElementById("lbl-up").textContent=q.swipe_up_label;
  document.getElementById("lbl-right").textContent=q.swipe_right_label;
  document.getElementById("lbl-down").textContent=q.swipe_down_label;
  document.getElementById("lbl-left").textContent=q.swipe_left_label;
}

/* =========================================================
   PHYSICS
   ========================================================= */
function bind(el,q){
  el.onpointerdown=e=>{
    startX=e.clientX;startY=e.clientY;
    el.onpointermove=m;
    el.onpointerup=u;
  };
  function m(e){
    const dx=e.clientX-startX,dy=e.clientY-startY;
    el.style.transform=`translate(-50%,-50%) translate(${dx}px,${dy}px) rotate(${dx*.04}deg)`;
  }
  function u(e){
    el.onpointermove=null;
    const dx=e.clientX-startX,dy=e.clientY-startY;
    let dir=null;
    if(Math.abs(dx)>80) dir=dx>0?"right":"left";
    if(Math.abs(dy)>80) dir=dy<0?"up":"down";
    commit(dir,q);
  }
}

/* =========================================================
   COMMIT
   ========================================================= */
function commit(dir,q){
  if(dir==="left"){
    injectContext(q);
    return;
  }
  logSwipe(dir,q);
  idx++;
  render();
}

/* =========================================================
   CONTEXT (DEEP DIVE)
   ========================================================= */
function injectContext(q){
  const c=document.createElement("div");
  c.className="card context";
  c.innerHTML=`<p>Context</p><ul><li>${q.question_text}</li></ul>`;
  const s=document.getElementById("stage");
  s.innerHTML="";
  s.appendChild(c);
  setTimeout(()=>{idx++;render();},800);
}

/* =========================================================
   LOG
   ========================================================= */
function logSwipe(dir,q){
  fetch(GOOGLE_SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({id:q.question_id,swipe:dir,ts:Date.now()}),
    mode:"no-cors"
  });
}
</script>
</body>
</html>
