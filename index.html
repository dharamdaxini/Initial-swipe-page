<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#09090b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Strategic Convergence 2026: Operator Exam</title>

    <style>
        /* IMPORT FONTS */
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;500;600;800&display=swap');

        /* CSS VARIABLES - THEME CONFIGURATION */
        :root {
            /* COLORS: Backgrounds */
            --bg-deep: #09090b;
            --bg-surface: #18181b;
            --bg-overlay: rgba(0, 0, 0, 0.8);
            
            /* COLORS: Cards */
            --card-bg: #ffffff;
            --card-border: #e4e4e7;
            
            /* COLORS: Typography */
            --text-primary: #f4f4f5;
            --text-secondary: #a1a1aa;
            --text-tertiary: #52525b;
            --text-on-card: #18181b;

            /* COLORS: Semantics (Swipe Indicators) */
            --color-up: #22c55e;    /* Success/True */
            --color-down: #ef4444;  /* Danger/False */
            --color-left: #64748b;  /* Neutral/Skip */
            --color-right: #eab308; /* Warning/Unsure */

            /* DIMENSIONS */
            --header-height: 15%;
            --footer-height: 25%;
            --card-width: 90%;
            --card-max-width: 380px;
            
            /* ANIMATION & PHYSICS */
            --transition-smooth: cubic-bezier(0.2, 0.8, 0.2, 1);
            --transition-snap: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            
            /* SHADOWS */
            --shadow-card-resting: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-card-active: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-desktop: 0 0 100px rgba(0,0,0,0.8);
        }

        /* RESET & GLOBAL BEHAVIOR */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            /* CRITICAL: Disables browser handling of gestures */
            touch-action: none; 
            user-select: none;
            -webkit-user-select: none;
        }

        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: #000;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* APP SHELL: The main phone container */
        #app-shell {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 450px;
            max-height: 950px;
            background-color: var(--bg-deep);
            display: grid;
            grid-template-rows: var(--header-height) 1fr var(--footer-height);
            box-shadow: var(--shadow-desktop);
            overflow: hidden;
        }

        /* * --- ZONE 1: HEADER --- 
         */
        #ui-header {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 1.5rem;
            z-index: 20;
            pointer-events: none; /* Let touches pass through */
        }

        .progress-track {
            width: 60px;
            height: 4px;
            background: #27272a;
            border-radius: 10px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--color-up);
            width: 0%;
            transition: width 0.3s ease;
        }

        .header-topic {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-secondary);
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .header-type {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* * --- ZONE 2: CARD STACK (The Interactive Layer) --- 
         */
        #card-stack {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
            z-index: 10;
        }

        .card {
            position: absolute;
            width: var(--card-width);
            max-width: var(--card-max-width);
            aspect-ratio: 1/1.1;
            background: var(--card-bg);
            border-radius: 28px;
            box-shadow: var(--shadow-card-resting);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2.5rem;
            text-align: center;
            
            /* Performance Optimizations */
            will-change: transform, opacity;
            transform-style: preserve-3d;
            backface-visibility: hidden;
            transform: translate3d(0,0,0); /* Hardware Acceleration Force */
        }

        .card p {
            font-size: 1.4rem;
            line-height: 1.45;
            font-weight: 600;
            color: var(--text-on-card);
            pointer-events: none; /* Text shouldn't block card drag */
        }

        .card-meta {
            position: absolute;
            bottom: 2rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.6rem;
            color: #d4d4d8;
            pointer-events: none;
        }

        /* Visual State: Card being dragged */
        .card.dragging {
            box-shadow: var(--shadow-card-active);
            cursor: grabbing;
        }

        /* * --- ZONE 3: FOOTER (Controls) --- 
         */
        #ui-footer {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            grid-template-rows: 1fr 1fr;
            align-content: center;
            justify-items: center;
            z-index: 20;
            padding-bottom: 2rem;
            pointer-events: none;
        }

        .legend-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s linear, color 0.1s linear;
        }

        /* Grid Positioning */
        .legend-item.up    { grid-column: 2; grid-row: 1; margin-bottom: 0.5rem; }
        .legend-item.down  { grid-column: 2; grid-row: 2; margin-top: 0.5rem; }
        .legend-item.left  { grid-column: 1; grid-row: 2; }
        .legend-item.right { grid-column: 3; grid-row: 2; }

        .legend-icon {
            font-size: 1.8rem;
            margin-bottom: 4px;
            display: block;
            line-height: 1;
            color: var(--text-secondary);
        }

        .legend-label {
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-tertiary);
        }

        /* * --- SCREENS: START & SUMMARY --- 
         */
        .screen-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-deep);
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }
        
        .screen-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Start Screen */
        .title-hero {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 1rem;
            letter-spacing: -0.05em;
        }
        
        .btn-main {
            background: var(--text-primary);
            color: var(--bg-deep);
            border: none;
            padding: 1.2rem 3rem;
            font-size: 1rem;
            font-weight: 700;
            border-radius: 100px;
            cursor: pointer;
            margin-top: 2rem;
        }

        /* Summary Screen */
        .stats-grid {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .stat-box { text-align: center; }
        .stat-val { font-size: 2.5rem; font-weight: 800; color: var(--text-primary); display: block;}
        .stat-lbl { font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; }

        /* DEBUG CONSOLE (Bottom Right) */
        #debug-console {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-family: monospace;
            font-size: 10px;
            color: #333;
            pointer-events: none;
            z-index: 1000;
        }

        /* UTILS */
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div id="app-shell">

        <section id="screen-start" class="screen-overlay active">
            <h1 class="title-hero">Strategic<br>Convergence</h1>
            <p style="color:var(--text-secondary); text-align:center; max-width:300px; line-height:1.5;">
                Operator Exam 2026.<br>30 Questions.<br>Swipe to decide.
            </p>
            <button class="btn-main" onclick="GAME.start()">INITIATE SEQUENCE</button>
        </section>

        <header id="ui-header">
            <div class="progress-track"><div class="progress-fill" id="ui-progress"></div></div>
            <span class="header-topic" id="ui-topic">Topic</span>
            <span class="header-type" id="ui-type">Type</span>
        </header>

        <div id="card-stack">
            </div>

        <footer id="ui-footer">
            <div class="legend-item up">
                <span class="legend-icon">↑</span>
                <span class="legend-label" id="lbl-up">True</span>
            </div>
            <div class="legend-item left">
                <span class="legend-icon">←</span>
                <span class="legend-label" id="lbl-left">Skip</span>
            </div>
            <div class="legend-item down">
                <span class="legend-icon">↓</span>
                <span class="legend-label" id="lbl-down">False</span>
            </div>
            <div class="legend-item right">
                <span class="legend-icon">→</span>
                <span class="legend-label" id="lbl-right">Unsure</span>
            </div>
        </footer>

        <section id="screen-summary" class="screen-overlay">
            <h2 class="header-type" style="margin-bottom:2rem;">Mission Report</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <span class="stat-val" id="res-score">0</span>
                    <span class="stat-lbl">Points</span>
                </div>
                <div class="stat-box">
                    <span class="stat-val" id="res-acc">0%</span>
                    <span class="stat-lbl">Accuracy</span>
                </div>
            </div>
            <p style="color:var(--text-secondary); margin-bottom:2rem;">Syncing results...</p>
            <button class="btn-main" onclick="location.reload()">RESTART</button>
        </section>

        <div id="debug-console">v2.0 Ready</div>

    </div>

    <script>
        /**
         * CONFIGURATION
         */
        const CONFIG = {
            API_URL: "https://script.google.com/macros/s/AKfycbz_ziu5Dezrz35J2FksQtNEYuZ5Kk6TrQvg3pM5O5eBYUDzWCCtqlGWwZj8D-TBQLFw/exec",
            SWIPE_THRESHOLD: 80, // Pixels needed to commit a swipe
            ROTATION_STRENGTH: 0.05,
            COLORS: {
                UP: '#22c55e', DOWN: '#ef4444', RIGHT: '#eab308', LEFT: '#64748b', NEUTRAL: '#71717a'
            }
        };

        /**
         * DATA: 30 Questions
         */
        const QUESTIONS = [
            { id: "s1", topic: "Strategic", type: "FACT", text: "Dholera fab is shipping 28nm commercial wafers.", up:"True", down:"False", right:"Plausible", left:"Skip", correct:"up", w:1 },
            { id: "s2", topic: "Strategic", type: "CONTEXT", text: "India's molten salt reactor prototype is grid-connected.", up:"Yes", down:"No", right:"Unsure", left:"Skip", correct:"right", w:2 },
            { id: "s3", topic: "Strategic", type: "TRAP", text: "India formally joined the G7 as a permanent member in 2025.", up:"True", down:"False", right:"Observer", left:"Skip", correct:"down", w:1 },
            { id: "s4", topic: "Strategic", type: "REASONING", text: "IMEC corridor construction paused due to regional conflict.", up:"True", down:"False", right:"Partially", left:"Skip", correct:"up", w:2 },
            { id: "s5", topic: "Defense", type: "FACT", text: "Tejas Mk1A delivery to IAF has crossed 50 units.", up:"True", down:"False", right:"Unsure", left:"Skip", correct:"up", w:1 },
            { id: "e1", topic: "Trade", type: "CONTEXT", text: "Rupee trade settlement volume with UAE exceeded $50B.", up:"True", down:"False", right:"Unsure", left:"Skip", correct:"up", w:2 },
            { id: "e2", topic: "Trade", type: "TRAP", text: "India signed a full FTA with the United States.", up:"True", down:"False", right:"Mini-deal", left:"Skip", correct:"down", w:1 },
            { id: "e3", topic: "Infra", type: "FACT", text: "Mumbai-Ahmedabad Bullet Train is fully operational.", up:"True", down:"False", right:"Partial", left:"Skip", correct:"right", w:1 },
            { id: "e4", topic: "Infra", type: "REASONING", text: "Dedicated Freight Corridor (EDFC) is 100% complete.", up:"True", down:"False", right:"Almost", left:"Skip", correct:"up", w:1 },
            { id: "e5", topic: "Digital", type: "FACT", text: "Oteher nations adopting UPI has crossed 15 countries.", up:"True", down:"False", right:"Unsure", left:"Skip", correct:"up", w:1 },
            { id: "e6", topic: "Digital", type: "CONTEXT", text: "Digital Rupee (e-Rupee) retail usage exceeds cash in metro cities.", up:"True", down:"False", right:"Plausible", left:"Skip", correct:"down", w:2 },
            { id: "e7", topic: "Mfg", type: "FACT", text: "Apple exports from India have surpassed $20 Billion.", up:"True", down:"False", right:"Unsure", left:"Skip", correct:"up", w:1 },
            { id: "e8", topic: "Mfg", type: "TRAP", text: "Tesla has opened a Gigafactory in Gujarat.", up:"True", down:"False", right:"Announced", left:"Skip", correct:"right", w:1 },
            { id: "e9", topic: "Agri", type: "REASONING", text: "Drone-as-a-Service for agriculture is now a subsidized scheme.", up:"True", down:"False", right:"Pilot", left:"Skip", correct:"up", w:1 },
            { id: "e10", topic: "Startup", type: "FACT", text: "India has produced 150th Unicorn.", up:"True", down:"False", right:"Unsure", left:"Skip", correct:"up", w:1 }
        ];

        /**
         * STATE MANAGEMENT
         */
        const STATE = {
            deck: [],
            currentIndex: 0,
            answers: {},
            activeCard: null
        };

        /**
         * GAME ENGINE
         */
        const GAME = {
            init() {
                // Prepare deck
                STATE.deck = [...QUESTIONS]; // Optional: .sort(() => Math.random() - 0.5) to shuffle
                console.log("System Initialized");
            },

            start() {
                this.init();
                document.getElementById('screen-start').classList.remove('active');
                this.renderStack();
            },

            renderStack() {
                const stackEl = document.getElementById('card-stack');
                stackEl.innerHTML = ''; // Clear

                const idx = STATE.currentIndex;
                if (idx >= STATE.deck.length) return this.finish();

                // Render in reverse so Top card is last in DOM (on top of z-index)
                // We render 2 cards max for performance
                const buffer = STATE.deck.slice(idx, idx + 2).reverse();

                buffer.forEach((q, i) => {
                    const realIndex = idx + (buffer.length - 1 - i);
                    const isTop = (realIndex === idx);
                    
                    const el = document.createElement('div');
                    el.classList.add('card');
                    el.dataset.id = q.id;
                    
                    if (isTop) {
                        el.style.zIndex = 100;
                        STATE.activeCard = el; // Reference for Physics
                    } else {
                        el.style.zIndex = 50;
                        el.style.transform = 'scale(0.95) translateY(10px)';
                        el.style.opacity = '0.5';
                    }

                    el.innerHTML = `
                        <p>${q.text}</p>
                        <div class="card-meta">ID: ${q.id}</div>
                    `;

                    stackEl.appendChild(el);
                });

                this.updateUI();
                
                // CRITICAL: Bind Touch Events to the new Top Card
                if (STATE.activeCard) {
                    TOUCH.bind(STATE.activeCard);
                }
            },

            updateUI() {
                const q = STATE.deck[STATE.currentIndex];
                if (!q) return;

                document.getElementById('ui-topic').textContent = q.topic;
                document.getElementById('ui-type').textContent = q.type;
                
                const pct = ((STATE.currentIndex) / STATE.deck.length) * 100;
                document.getElementById('ui-progress').style.width = `${pct}%`;

                // Update Footer Labels
                document.getElementById('lbl-up').textContent = q.up;
                document.getElementById('lbl-down').textContent = q.down;
                document.getElementById('lbl-left').textContent = q.left;
                document.getElementById('lbl-right').textContent = q.right;
            },

            finish() {
                document.getElementById('screen-summary').classList.add('active');
                
                // Calc Score
                const answers = Object.values(STATE.answers);
                const totalScore = answers.reduce((acc, curr) => acc + curr.score, 0);
                const correctCount = answers.filter(a => a.correct).length;
                const accuracy = Math.round((correctCount / STATE.deck.length) * 100);

                document.getElementById('res-score').textContent = totalScore;
                document.getElementById('res-acc').textContent = accuracy + "%";

                this.sync(totalScore, answers);
            },

            sync(score, answers) {
                const payload = {
                    score: score,
                    answers: answers,
                    timestamp: new Date().toISOString()
                };

                fetch(CONFIG.API_URL, {
                    method: "POST",
                    mode: "no-cors",
                    headers: { "Content-Type": "text/plain" },
                    body: JSON.stringify(payload)
                }).then(() => console.log("Data Synced"));
            }
        };

        /**
         * TOUCH & PHYSICS ENGINE (The "Heavy Duty" Logic)
         */
        const TOUCH = {
            target: null,
            startX: 0,
            startY: 0,
            isDragging: false,

            bind(el) {
                this.target = el;
                // Unbind previous to prevent memory leaks? (Browser handles mostly, but good practice)
                // Bind new
                el.addEventListener('touchstart', this.onStart.bind(this), { passive: false });
                el.addEventListener('mousedown', this.onStart.bind(this));
            },

            onStart(e) {
                // Prevent Default to stop scrolling IMMEDIATELY
                if (e.cancelable) e.preventDefault();
                
                this.isDragging = true;
                
                const pt = e.touches ? e.touches[0] : e;
                this.startX = pt.clientX;
                this.startY = pt.clientY;

                this.target.classList.add('dragging');
                this.target.style.transition = 'none'; // Instant movement

                // Bind Global Move/End (Capture even if finger leaves card)
                document.addEventListener('touchmove', this.onMove.bind(this), { passive: false });
                document.addEventListener('touchend', this.onEnd.bind(this));
                document.addEventListener('mousemove', this.onMove.bind(this));
                document.addEventListener('mouseup', this.onEnd.bind(this));
                
                document.getElementById('debug-console').textContent = "Input: Dragging";
            },

            onMove(e) {
                if (!this.isDragging) return;
                if (e.cancelable) e.preventDefault(); // HARD BLOCK SCROLLING

                const pt = e.touches ? e.touches[0] : e;
                const dx = pt.clientX - this.startX;
                const dy = pt.clientY - this.startY;

                // Physics: Translate & Rotate
                const rotation = dx * CONFIG.ROTATION_STRENGTH;
                this.target.style.transform = `translate(${dx}px, ${dy}px) rotate(${rotation}deg)`;

                // Visuals: Scale Arrows
                this.updateArrows(dx, dy);
            },

            onEnd(e) {
                if (!this.isDragging) return;
                this.isDragging = false;
                this.target.classList.remove('dragging');

                // Cleanup
                document.removeEventListener('touchmove', this.onMove.bind(this));
                document.removeEventListener('touchend', this.onEnd.bind(this));
                document.removeEventListener('mousemove', this.onMove.bind(this));
                document.removeEventListener('mouseup', this.onEnd.bind(this));

                // Determine Throw
                // Use changedTouches for the lifting finger
                const pt = e.changedTouches ? e.changedTouches[0] : e;
                const dx = pt.clientX - this.startX;
                const dy = pt.clientY - this.startY;

                const absX = Math.abs(dx);
                const absY = Math.abs(dy);

                let direction = null;

                if (absY > absX && absY > CONFIG.SWIPE_THRESHOLD) {
                    direction = dy < 0 ? 'up' : 'down';
                } else if (absX > absY && absX > CONFIG.SWIPE_THRESHOLD) {
                    direction = dx > 0 ? 'right' : 'left';
                }

                if (direction) {
                    this.commit(direction);
                } else {
                    this.reset();
                }
                
                document.getElementById('debug-console').textContent = "Input: Idle";
            },

            updateArrows(dx, dy) {
                const absX = Math.abs(dx);
                const absY = Math.abs(dy);
                const footer = document.getElementById('ui-footer');
                const items = footer.querySelectorAll('.legend-item');
                
                let activeClass = '';
                let activeColor = '';

                if (absY > absX) {
                    if (dy < 0) { activeClass = 'up'; activeColor = CONFIG.COLORS.UP; }
                    else { activeClass = 'down'; activeColor = CONFIG.COLORS.DOWN; }
                } else {
                    if (dx > 0) { activeClass = 'right'; activeColor = CONFIG.COLORS.RIGHT; }
                    else { activeClass = 'left'; activeColor = CONFIG.COLORS.LEFT; }
                }

                // Apply styles
                items.forEach(item => {
                    const icon = item.querySelector('.legend-icon');
                    if (item.classList.contains(activeClass)) {
                        item.style.transform = 'scale(1.2)';
                        icon.style.color = activeColor;
                    } else {
                        item.style.transform = 'scale(1)';
                        icon.style.color = CONFIG.COLORS.NEUTRAL;
                    }
                });
            },

            reset() {
                this.target.style.transition = `transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)`;
                this.target.style.transform = 'translate(0,0) rotate(0)';
                this.clearArrows();
            },

            commit(dir) {
                const q = STATE.deck[STATE.currentIndex];
                
                // Scoring
                let score = 0;
                let isCorrect = (dir === q.correct);
                if (isCorrect) score = 10 * q.w;
                else if (dir === 'left') score = 0;
                else score = -5;

                STATE.answers[q.id] = { dir, score, correct: isCorrect };

                // Fly away animation
                let tx = 0, ty = 0;
                const dist = 1000;
                if (dir === 'up') ty = -dist;
                if (dir === 'down') ty = dist;
                if (dir === 'left') tx = -dist;
                if (dir === 'right') tx = dist;

                this.target.style.transition = 'transform 0.3s ease-in';
                this.target.style.transform = `translate(${tx}px, ${ty}px) rotate(${tx * 0.1}deg)`;

                this.clearArrows();

                setTimeout(() => {
                    this.target.remove();
                    STATE.currentIndex++;
                    GAME.renderStack();
                }, 300);
            },

            clearArrows() {
                const items = document.querySelectorAll('.legend-item');
                items.forEach(item => {
                    item.style.transform = '';
                    item.querySelector('.legend-icon').style.color = '';
                });
            }
        };

        // --- PREVENT SCROLL BOUNCE ON IOS ---
        document.body.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });

    </script>
</body>
</html>
