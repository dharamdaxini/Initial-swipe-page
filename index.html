<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Alchemist V78.2 Final</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,600;1,600&family=Inter:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">

<style>
/* V78.2 CSS - FULL PRODUCTION BUILD */
:root { --bg-color: #000; --card-bg: #111; --accent-gold: #ffd600; --hint-blue: #3498db; --font-ui: 'Inter', sans-serif; --font-chem: 'Crimson Text', serif; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { margin: 0; height: 100vh; background: var(--bg-color); color: #fff; font-family: var(--font-ui); overflow: hidden; touch-action: none; user-select: none; }
sub { font-size: 0.7em; vertical-align: sub; line-height: 0; }
sup { font-size: 0.7em; vertical-align: super; line-height: 0; }

#header { width: 90%; margin: calc(20px + env(safe-area-inset-top)) auto 0; pointer-events: none; }
.header-meta { display: flex; justify-content: space-between; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: #555; margin-bottom: 8px; }
.progress-track { width: 100%; height: 3px; background: #222; border-radius: 2px; }
#progress-bar { height: 100%; background: var(--accent-gold); width: 0%; transition: width 0.4s ease; }

#stack { position: relative; width: 92%; max-width: 400px; height: calc(100vh - 160px - env(safe-area-inset-top)); margin: 25px auto 0; perspective: 1200px; }

.card { position: absolute; width: 100%; height: 100%; background: var(--card-bg); border-radius: 40px; border: 1px solid #282828; padding: 40px; display: flex; flex-direction: column; justify-content: center; transform-origin: center center; box-shadow: 0 20px 60px rgba(0,0,0,0.9); will-change: transform; }
.card-q { font-family: var(--font-chem); font-size: 2rem; line-height: 1.35; font-style: italic; font-weight: 600; text-align: center; color: #f0f0f0; }

/* SWIPE LABELS */
.swipe-label { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); font-weight: 900; font-size: 2.1rem; text-transform: uppercase; border-radius: 40px; opacity: 0; pointer-events: none; transition: opacity 0.08s linear; z-index:100; }
.sl-down-hint { 
    color: var(--hint-blue) !important; 
    font-size: 1.6rem !important; 
    text-transform: none !important; 
    font-family: var(--font-chem) !important;
    background: rgba(0,0,0,0.95) !important; 
    padding: 30px !important;
}

.overlay { position: absolute; inset: 0; background: #0d0d0d; z-index: 1100; padding: 45px 35px; opacity: 0; pointer-events: none; border-radius: 40px; display: flex; flex-direction: column; justify-content: center; transition: opacity 0.2s; }
.overlay.active { opacity: 1; pointer-events: auto; }
.overlay-label { font-size: 0.8rem; color: var(--accent-gold); font-family: 'JetBrains Mono', monospace; margin-bottom: 15px; text-transform: uppercase; }
.overlay-body { font-size: 1.25rem; line-height: 1.6; color: #ccc; margin-bottom: 30px; font-family: var(--font-chem); }

.input-name { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #333; background: #222; color: #fff; font-family: var(--font-ui); font-size: 1rem; margin-bottom: 15px; text-align: center; }
.btn { width: 100%; padding: 18px; border-radius: 60px; border: none; background: #fff; color: #000; font-weight: 900; cursor: pointer; text-transform: uppercase; font-family: var(--font-ui); margin-top: 10px; }
.btn-save { background: var(--accent-gold); color: #000; }

#loader { position: fixed; inset: 0; background: #000; z-index: 5000; display: flex; align-items: center; justify-content: center; font-family: 'JetBrains Mono', monospace; font-size: 1.2rem; letter-spacing: 5px; color: var(--accent-gold); flex-direction: column; }
#status-msg { font-size: 0.8rem; margin-top: 10px; color: #666; font-family: var(--font-ui); text-align: center; min-height: 20px;}
</style>
</head>

<body>
<div id="loader">ALCHEMIST<br><small style="font-size:0.5em; opacity:0.5; margin-top:10px;">V78.2 LOADED</small></div>

<div id="header">
    <div class="header-meta"><span id="rank-ui">RANK: NOVICE</span><span id="xp-ui">0 XP</span></div>
    <div class="progress-track"><div id="progress-bar"></div></div>
</div>

<div id="stack"></div>

<script>
// *** YOUR SCRIPT URL HERE ***
const ENDPOINT = "https://script.google.com/macros/s/AKfycbxaMo1Gi8KjfYOr1_pHJI5XYJ1t9FK4PWkFCm8lU4MsCmUXvY0nSUIqYTAqhpumFRFL/exec";

// *** FULL 90-QUESTION DATASET ***
const BACKUP_DATA = [
  { "dataset": "SET_A", "topic": "Physical", "q_type": "CONCEPT", "question_text": "What does a negative Î”G value signify?", "hint": "Gibbs Energy.", "explanation": "âœ… Spontaneous reaction.", "swipe_up_label": "Spontaneous", "swipe_right_label": "Equilibrium", "swipe_down_label": "HINT", "swipe_left_label": "Non-spontaneous", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Physical", "q_type": "APPLICATION", "question_text": "If reaction rate doubles when T increases from 298K to 308K, effect on k?", "hint": "Arrhenius equation.", "explanation": "âœ… k increases exponentially.", "swipe_up_label": "k Increases", "swipe_right_label": "k is Constant", "swipe_down_label": "HINT", "swipe_left_label": "k Decreases", "correct": "UP", "weight": 2 },
  { "dataset": "SET_A", "topic": "Physical", "q_type": "CONCEPT", "question_text": "Half-life vs concentration in 1st order?", "hint": "t1/2 = 0.693/k", "explanation": "âœ… Independent.", "swipe_up_label": "Increases", "swipe_right_label": "Independent", "swipe_down_label": "HINT", "swipe_left_label": "Decreases", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_A", "topic": "Physical", "q_type": "APPLICATION", "question_text": "Zn2+/Zn (-0.76V) vs Cu2+/Cu (+0.34V). Eo cell?", "hint": "Cathode - Anode.", "explanation": "âœ… 1.10 V.", "swipe_up_label": "-0.42 V", "swipe_right_label": "1.10 V", "swipe_down_label": "HINT", "swipe_left_label": "0.42 V", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_A", "topic": "Physical", "q_type": "CONCEPT", "question_text": "Equilibrium: Forward vs Backward rates?", "hint": "Dynamic state.", "explanation": "âœ… Rates are equal.", "swipe_up_label": "Zero", "swipe_right_label": "Equal", "swipe_down_label": "HINT", "swipe_left_label": "Forward > Back", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_A", "topic": "Physical", "q_type": "APPLICATION", "question_text": "pH of 0.001 M HCl?", "hint": "-log[H+].", "explanation": "âœ… pH 3.", "swipe_up_label": "pH 7", "swipe_right_label": "pH 3", "swipe_down_label": "HINT", "swipe_left_label": "pH 1", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Physical", "q_type": "CONCEPT", "question_text": "How does a catalyst work?", "hint": "Activation Energy.", "explanation": "âœ… Lowers Ea.", "swipe_up_label": "Changes K", "swipe_right_label": "Lowers Ea", "swipe_down_label": "HINT", "swipe_left_label": "Increases Ea", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Physical", "q_type": "APPLICATION", "question_text": "Haber Process: High Pressure?", "hint": "Le Chatelier.", "explanation": "âœ… Shifts Right (Fewer moles).", "swipe_up_label": "Left", "swipe_right_label": "No Effect", "swipe_down_label": "HINT", "swipe_left_label": "Right", "correct": "LEFT", "weight": 2 },
  { "dataset": "SET_B", "topic": "Physical", "q_type": "CONCEPT", "question_text": "Rusting requires?", "hint": "Air & Water.", "explanation": "âœ… O2 + H2O.", "swipe_up_label": "O2 + H2O", "swipe_right_label": "H2O only", "swipe_down_label": "HINT", "swipe_left_label": "N2", "correct": "UP", "weight": 1 },
  { "dataset": "SET_B", "topic": "Physical", "q_type": "APPLICATION", "question_text": "Brine Electrolysis Anode Product?", "hint": "Oxidation.", "explanation": "âœ… Cl2 Gas.", "swipe_up_label": "H2", "swipe_right_label": "Cl2", "swipe_down_label": "HINT", "swipe_left_label": "Na", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_B", "topic": "Physical", "q_type": "CONCEPT", "question_text": "Helium in diving tanks?", "hint": "Blood solubility.", "explanation": "âœ… Low solubility prevents bends.", "swipe_up_label": "Cost", "swipe_right_label": "Solubility", "swipe_down_label": "HINT", "swipe_left_label": "Weight", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Physical", "q_type": "APPLICATION", "question_text": "Half-life 6h. After 24h?", "hint": "4 cycles.", "explanation": "âœ… 6.25%.", "swipe_up_label": "12.5%", "swipe_right_label": "25%", "swipe_down_label": "HINT", "swipe_left_label": "6.25%", "correct": "LEFT", "weight": 2 },
  { "dataset": "SET_A", "topic": "Organic", "q_type": "CONCEPT", "question_text": "Chiral Carbon?", "hint": "4 groups.", "explanation": "âœ… Bonded to 4 unique groups.", "swipe_up_label": "4 Unique", "swipe_right_label": "Symmetry", "swipe_down_label": "HINT", "swipe_left_label": "Double Bond", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Organic", "q_type": "APPLICATION", "question_text": "Fastest SN2?", "hint": "Sterics.", "explanation": "âœ… Methyl Halide.", "swipe_up_label": "Tertiary", "swipe_right_label": "Secondary", "swipe_down_label": "HINT", "swipe_left_label": "Methyl", "correct": "LEFT", "weight": 2 },
  { "dataset": "SET_A", "topic": "Organic", "q_type": "CONCEPT", "question_text": "SN1 Intermediate?", "hint": "Carbo...", "explanation": "âœ… Carbocation.", "swipe_up_label": "Carbanion", "swipe_right_label": "Radical", "swipe_down_label": "HINT", "swipe_left_label": "Carbocation", "correct": "LEFT", "weight": 1 },
  { "dataset": "SET_A", "topic": "Organic", "q_type": "APPLICATION", "question_text": "IUPAC: CH3CH2CH(CH3)2", "hint": "Long chain.", "explanation": "âœ… 2-Methylbutane.", "swipe_up_label": "Pentane", "swipe_right_label": "Isopentane", "swipe_down_label": "HINT", "swipe_left_label": "2-Methylbutane", "correct": "LEFT", "weight": 2 },
  { "dataset": "SET_A", "topic": "Organic", "q_type": "CONCEPT", "question_text": "Ethene Hybridization?", "hint": "Planar.", "explanation": "âœ… sp2.", "swipe_up_label": "sp", "swipe_right_label": "sp2", "swipe_down_label": "HINT", "swipe_left_label": "sp3", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_A", "topic": "Organic", "q_type": "APPLICATION", "question_text": "Markovnikov HBr + Propene?", "hint": "Stable Cation.", "explanation": "âœ… H to C1, Br to C2.", "swipe_up_label": "C3", "swipe_right_label": "C1", "swipe_down_label": "HINT", "swipe_left_label": "C2", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_B", "topic": "Organic", "q_type": "CONCEPT", "question_text": "Teflon Monomer?", "hint": "F atoms.", "explanation": "âœ… Tetrafluoroethene.", "swipe_up_label": "Nylon", "swipe_right_label": "Teflon", "swipe_down_label": "HINT", "swipe_left_label": "PVC", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Organic", "q_type": "APPLICATION", "question_text": "Saponification products?", "hint": "Soap.", "explanation": "âœ… Soap + Glycerol.", "swipe_up_label": "Soap+Glycerol", "swipe_right_label": "Ester+Water", "swipe_down_label": "HINT", "swipe_left_label": "Acid+Alc", "correct": "UP", "weight": 2 },
  { "dataset": "SET_B", "topic": "Organic", "q_type": "CONCEPT", "question_text": "CFC harm?", "hint": "Ozone.", "explanation": "âœ… Ozone Depletion.", "swipe_up_label": "Smog", "swipe_right_label": "Ozone", "swipe_down_label": "HINT", "swipe_left_label": "Acid Rain", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Organic", "q_type": "APPLICATION", "question_text": "Aspirin synthesis group?", "hint": "COOH + OH.", "explanation": "âœ… Ester.", "swipe_up_label": "Ether", "swipe_right_label": "Amide", "swipe_down_label": "HINT", "swipe_left_label": "Ester", "correct": "LEFT", "weight": 2 },
  { "dataset": "SET_B", "topic": "Organic", "q_type": "CONCEPT", "question_text": "Octane Rating?", "hint": "Knocking.", "explanation": "âœ… Knock Resistance.", "swipe_up_label": "Energy", "swipe_right_label": "Knock Resist", "swipe_down_label": "HINT", "swipe_left_label": "Speed", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Organic", "q_type": "APPLICATION", "question_text": "Hydrogenation Catalyst?", "hint": "Metal.", "explanation": "âœ… Nickel.", "swipe_up_label": "Vanadium", "swipe_right_label": "Platinum", "swipe_down_label": "HINT", "swipe_left_label": "Nickel", "correct": "LEFT", "weight": 2 },
  { "dataset": "SET_A", "topic": "Inorganic", "q_type": "CONCEPT", "question_text": "SF6 Geometry?", "hint": "6 pairs.", "explanation": "âœ… Octahedral.", "swipe_up_label": "Octahedral", "swipe_right_label": "Tetrahedral", "swipe_down_label": "HINT", "swipe_left_label": "Square", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Inorganic", "q_type": "APPLICATION", "question_text": "PCl5 Hybridization?", "hint": "5 pairs.", "explanation": "âœ… sp3d.", "swipe_up_label": "sp3d", "swipe_right_label": "sp3", "swipe_down_label": "HINT", "swipe_left_label": "sp3d2", "correct": "UP", "weight": 2 },
  { "dataset": "SET_A", "topic": "Inorganic", "q_type": "CONCEPT", "question_text": "Transition Color?", "hint": "d-orbitals.", "explanation": "âœ… d-d transitions.", "swipe_up_label": "d-d", "swipe_right_label": "s-p", "swipe_down_label": "HINT", "swipe_left_label": "Mass", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Inorganic", "q_type": "APPLICATION", "question_text": "Mn oxidation in KMnO4?", "hint": "K+1, O-2.", "explanation": "âœ… +7.", "swipe_up_label": "+7", "swipe_right_label": "+2", "swipe_down_label": "HINT", "swipe_left_label": "+4", "correct": "UP", "weight": 2 },
  { "dataset": "SET_A", "topic": "Inorganic", "q_type": "CONCEPT", "question_text": "Strong Field Ligand?", "hint": "Spin.", "explanation": "âœ… Low Spin.", "swipe_up_label": "Low Spin", "swipe_right_label": "High Spin", "swipe_down_label": "HINT", "swipe_left_label": "Neutral", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Inorganic", "q_type": "APPLICATION", "question_text": "Paramagnetic Ion?", "hint": "Unpaired.", "explanation": "âœ… Fe3+.", "swipe_up_label": "Sc3+", "swipe_right_label": "Zn2+", "swipe_down_label": "HINT", "swipe_left_label": "Fe3+", "correct": "LEFT", "weight": 2 },
  { "dataset": "SET_B", "topic": "Inorganic", "q_type": "CONCEPT", "question_text": "Froth Flotation?", "hint": "Ore type.", "explanation": "âœ… Sulfide Ores.", "swipe_up_label": "Refining", "swipe_right_label": "Concentration", "swipe_down_label": "HINT", "swipe_left_label": "Reduction", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Inorganic", "q_type": "APPLICATION", "question_text": "Blast Furnace Reducer?", "hint": "CO.", "explanation": "âœ… Carbon Monoxide.", "swipe_up_label": "CO2", "swipe_right_label": "CO", "swipe_down_label": "HINT", "swipe_left_label": "O2", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_B", "topic": "Inorganic", "q_type": "CONCEPT", "question_text": "P in NPK?", "hint": "Roots.", "explanation": "âœ… Phosphorus.", "swipe_up_label": "Lead", "swipe_right_label": "Phosphorus", "swipe_down_label": "HINT", "swipe_left_label": "Potassium", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Inorganic", "q_type": "APPLICATION", "question_text": "Zeolites function?", "hint": "Softening.", "explanation": "âœ… Ion Exchange.", "swipe_up_label": "Ion Exchange", "swipe_right_label": "Filter", "swipe_down_label": "HINT", "swipe_left_label": "Precip", "correct": "UP", "weight": 2 },
  { "dataset": "SET_B", "topic": "Inorganic", "q_type": "CONCEPT", "question_text": "Stainless Steel Alloy?", "hint": "Shiny.", "explanation": "âœ… Chromium.", "swipe_up_label": "Chromium", "swipe_right_label": "Copper", "swipe_down_label": "HINT", "swipe_left_label": "Carbon", "correct": "UP", "weight": 1 },
  { "dataset": "SET_B", "topic": "Inorganic", "q_type": "APPLICATION", "question_text": "AgBr use?", "hint": "Photos.", "explanation": "âœ… Light Sensitivity.", "swipe_up_label": "Develop", "swipe_right_label": "Light Sens", "swipe_down_label": "HINT", "swipe_left_label": "Reflect", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_A", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "NMR Standard?", "hint": "0.0 ppm.", "explanation": "âœ… TMS.", "swipe_up_label": "TMS", "swipe_right_label": "Benzene", "swipe_down_label": "HINT", "swipe_left_label": "Water", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Analytical", "q_type": "APPLICATION", "question_text": "IR 1710 cm-1?", "hint": "C=O.", "explanation": "âœ… Carbonyl.", "swipe_up_label": "Carbonyl", "swipe_right_label": "Alkane", "swipe_down_label": "HINT", "swipe_left_label": "Alcohol", "correct": "UP", "weight": 2 },
  { "dataset": "SET_A", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "Molecular Ion?", "hint": "Weight.", "explanation": "âœ… Mass of molecule.", "swipe_up_label": "Mol Ion", "swipe_right_label": "Fragment", "swipe_down_label": "HINT", "swipe_left_label": "Base Peak", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Analytical", "q_type": "APPLICATION", "question_text": "HCl + NaOH pH?", "hint": "Neutral.", "explanation": "âœ… pH 7.", "swipe_up_label": "9", "swipe_right_label": "7", "swipe_down_label": "HINT", "swipe_left_label": "4", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_A", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "Beer-Lambert?", "hint": "Conc.", "explanation": "âœ… Absorbance prop. to Conc.", "swipe_up_label": "Vol", "swipe_right_label": "Conc", "swipe_down_label": "HINT", "swipe_left_label": "Temp", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "BOD?", "hint": "Pollution.", "explanation": "âœ… Oxygen Demand.", "swipe_up_label": "O2 Demand", "swipe_right_label": "CO2", "swipe_down_label": "HINT", "swipe_left_label": "Mineral", "correct": "UP", "weight": 1 },
  { "dataset": "SET_B", "topic": "Analytical", "q_type": "APPLICATION", "question_text": "Rf value?", "hint": "Ratio.", "explanation": "âœ… Solute Dist / Solvent Dist.", "swipe_up_label": "Solute/Solv", "swipe_right_label": "Mass", "swipe_down_label": "HINT", "swipe_left_label": "Solv/Solute", "correct": "UP", "weight": 2 },
  { "dataset": "SET_B", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "Drink Preservative?", "hint": "Benzoate.", "explanation": "âœ… Sodium Benzoate.", "swipe_up_label": "Glucose", "swipe_right_label": "Benzoate", "swipe_down_label": "HINT", "swipe_left_label": "Salt", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_B", "topic": "Analytical", "q_type": "APPLICATION", "question_text": "Soil pH?", "hint": "Farming.", "explanation": "âœ… Nutrient Access.", "swipe_up_label": "Moist", "swipe_right_label": "Nutrient", "swipe_down_label": "HINT", "swipe_left_label": "Dense", "correct": "UP", "weight": 2 },
  { "dataset": "SET_B", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "Blank sample?", "hint": "Zero.", "explanation": "âœ… Zeroing instrument.", "swipe_up_label": "Zeroing", "swipe_right_label": "Color", "swipe_down_label": "HINT", "swipe_left_label": "Calib", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Mixed", "q_type": "CONCEPT", "question_text": "SN2 Favored by?", "hint": "Primary.", "explanation": "âœ… Primary + Aprotic.", "swipe_up_label": "Pri+Aprotic", "swipe_right_label": "Protic", "swipe_down_label": "HINT", "swipe_left_label": "Tertiary", "correct": "UP", "weight": 1 },
  { "dataset": "SET_A", "topic": "Mixed", "q_type": "APPLICATION", "question_text": "Non-spontaneous T?", "hint": "dH-, dS-.", "explanation": "âœ… High T (>500K).", "swipe_up_label": "500K", "swipe_right_label": "100K", "swipe_down_label": "HINT", "swipe_left_label": "250K", "correct": "UP", "weight": 2 },
  { "dataset": "SET_B", "topic": "Mixed", "q_type": "CONCEPT", "question_text": "Pool pH fix?", "hint": "Base.", "explanation": "âœ… Soda Ash.", "swipe_up_label": "Soda Ash", "swipe_right_label": "Salt", "swipe_down_label": "HINT", "swipe_left_label": "Acid", "correct": "UP", "weight": 1 },
  { "dataset": "SET_B", "topic": "Mixed", "q_type": "APPLICATION", "question_text": "Limestone in furnace?", "hint": "Slag.", "explanation": "âœ… Flux.", "swipe_up_label": "Flux", "swipe_right_label": "Fuel", "swipe_down_label": "HINT", "swipe_left_label": "Reduce", "correct": "UP", "weight": 2 },
  { "dataset": "SET_D", "topic": "Physical", "q_type": "CONCEPT", "question_text": "Rate vs Temp?", "hint": "Collisions.", "explanation": "âœ… Increases (Exceed Ea).", "swipe_up_label": "Collide", "swipe_right_label": "Exceed Ea", "swipe_down_label": "HINT", "swipe_left_label": "Ea drop", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_D", "topic": "Physical", "q_type": "APPLICATION", "question_text": "dG at Equilibrium?", "hint": "Zero.", "explanation": "âœ… dG = 0.", "swipe_up_label": "Neg", "swipe_right_label": "Zero", "swipe_down_label": "HINT", "swipe_left_label": "Pos", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_D", "topic": "Physical", "q_type": "CONCEPT", "question_text": "Melting Entropy?", "hint": "Disorder.", "explanation": "âœ… Increases.", "swipe_up_label": "Drop", "swipe_right_label": "Increase", "swipe_down_label": "HINT", "swipe_left_label": "Same", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_D", "topic": "Physical", "q_type": "APPLICATION", "question_text": "Catalyst & K?", "hint": "Thermo.", "explanation": "âœ… No effect.", "swipe_up_label": "dH", "swipe_right_label": "Kinetics", "swipe_down_label": "HINT", "swipe_left_label": "Prod", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_D", "topic": "Physical", "q_type": "CONCEPT", "question_text": "Pressure & Moles?", "hint": "Shift.", "explanation": "âœ… Shifts to fewer moles.", "swipe_up_label": "Vol", "swipe_right_label": "Stress", "swipe_down_label": "HINT", "swipe_left_label": "Rate", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_D", "topic": "Organic", "q_type": "CONCEPT", "question_text": "Tertiary Cation?", "hint": "Stable.", "explanation": "âœ… Most stable.", "swipe_up_label": "Mass", "swipe_right_label": "Stable", "swipe_down_label": "HINT", "swipe_left_label": "Steric", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_D", "topic": "Organic", "q_type": "APPLICATION", "question_text": "Tertiary SN2?", "hint": "Blocked.", "explanation": "âœ… Impossible (Steric).", "swipe_up_label": "Unstable", "swipe_right_label": "Block", "swipe_down_label": "HINT", "swipe_left_label": "Nuc", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_D", "topic": "Organic", "q_type": "CONCEPT", "question_text": "Aldehyde vs Ketone?", "hint": "Reactive.", "explanation": "âœ… Aldehyde more reactive.", "swipe_up_label": "C=O", "swipe_right_label": "Less Hind", "swipe_down_label": "HINT", "swipe_left_label": "Res", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_D", "topic": "Organic", "q_type": "APPLICATION", "question_text": "Conjugation UV?", "hint": "Gap.", "explanation": "âœ… Red shift (Lower Gap).", "swipe_up_label": "Bond", "swipe_right_label": "Low Gap", "swipe_down_label": "HINT", "swipe_left_label": "Mass", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_D", "topic": "Organic", "q_type": "CONCEPT", "question_text": "Phenol Acidic?", "hint": "Resonance.", "explanation": "âœ… Yes, stabilized ion.", "swipe_up_label": "Mass", "swipe_right_label": "Resonance", "swipe_down_label": "HINT", "swipe_left_label": "H-Bond", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_D", "topic": "Inorganic", "q_type": "CONCEPT", "question_text": "Variable Oxidation?", "hint": "d-shell.", "explanation": "âœ… Energy match.", "swipe_up_label": "EN", "swipe_right_label": "Energy", "swipe_down_label": "HINT", "swipe_left_label": "Rad", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_D", "topic": "Inorganic", "q_type": "APPLICATION", "question_text": "Strong Field?", "hint": "Gap.", "explanation": "âœ… Large Gap (Low Spin).", "swipe_up_label": "Coord", "swipe_right_label": "Large D", "swipe_down_label": "HINT", "swipe_left_label": "Weak", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_D", "topic": "Inorganic", "q_type": "CONCEPT", "question_text": "Zn2+ Magnetism?", "hint": "Paired.", "explanation": "âœ… Diamagnetic.", "swipe_up_label": "Ox", "swipe_right_label": "Paired", "swipe_down_label": "HINT", "swipe_left_label": "Field", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_D", "topic": "Inorganic", "q_type": "APPLICATION", "question_text": "BF3 Acid?", "hint": "Lewis.", "explanation": "âœ… Electron acceptor.", "swipe_up_label": "EN", "swipe_right_label": "Octet", "swipe_down_label": "HINT", "swipe_left_label": "Polar", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_D", "topic": "Inorganic", "q_type": "CONCEPT", "question_text": "Lattice Energy?", "hint": "Charge.", "explanation": "âœ… Higher charge = Higher energy.", "swipe_up_label": "Size", "swipe_right_label": "Charge", "swipe_down_label": "HINT", "swipe_left_label": "Cov", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "NMR Multiplicity?", "hint": "2nI+1.", "explanation": "âœ… Formula.", "swipe_up_label": "n+1", "swipe_right_label": "2nI+1", "swipe_down_label": "HINT", "swipe_left_label": "nI+1", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "Aldehyde Proton?", "hint": "ppm.", "explanation": "âœ… 9-10 ppm.", "swipe_up_label": "H-Bond", "swipe_right_label": "Aniso", "swipe_down_label": "HINT", "swipe_left_label": "Shield", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "APPLICATION", "question_text": "Conjugation IR?", "hint": "Lower.", "explanation": "âœ… Lowers frequency.", "swipe_up_label": "Dipole", "swipe_right_label": "Order", "swipe_down_label": "HINT", "swipe_left_label": "Steric", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "Homonuclear IR?", "hint": "Inactive.", "explanation": "âœ… No dipole change.", "swipe_up_label": "Bond", "swipe_right_label": "Dipole", "swipe_down_label": "HINT", "swipe_left_label": "Sym", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "APPLICATION", "question_text": "MS 3:1 ratio?", "hint": "Cl.", "explanation": "âœ… Chlorine.", "swipe_up_label": "Br", "swipe_right_label": "Cl", "swipe_down_label": "HINT", "swipe_left_label": "S", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "Base Peak?", "hint": "Tallest.", "explanation": "âœ… Most abundant.", "swipe_up_label": "Mol", "swipe_right_label": "Stable", "swipe_down_label": "HINT", "swipe_left_label": "m/z", "correct": "RIGHT", "weight": 1 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "APPLICATION", "question_text": "Weak Acid pH?", "hint": "Basic.", "explanation": "âœ… > 7.", "swipe_up_label": "Ppt", "swipe_right_label": "Hydro", "swipe_down_label": "HINT", "swipe_left_label": "Err", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "CONCEPT", "question_text": "Van Deemter High V?", "hint": "Mass transfer.", "explanation": "âœ… C-term.", "swipe_up_label": "A", "swipe_right_label": "C", "swipe_down_label": "HINT", "swipe_left_label": "B", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "APPLICATION", "question_text": "Larmor Freq?", "hint": "Field.", "explanation": "âœ… Prop to B0.", "swipe_up_label": "e-", "swipe_right_label": "B0", "swipe_down_label": "HINT", "swipe_left_label": "T", "correct": "RIGHT", "weight": 2 },
  { "dataset": "SET_C", "topic": "Analytical", "q_type": "APPLICATION", "question_text": "Faraday Constant?", "hint": "Charge.", "explanation": "âœ… Charge per mole e-.", "swipe_up_label": "V", "swipe_right_label": "Moles", "swipe_down_label": "HINT", "swipe_left_label": "pH", "correct": "RIGHT", "weight": 2 }
];

let RAW_DATA = [...BACKUP_DATA], POOL=[], MISTAKES=[], SCORE=0, isTransitioning=false;
let MODE="DATASET_SELECT", CURRENT_DATASET="", CURRENT_TOPIC="", CURRENT_GENRE="";
const CLAMP_DIST = 32; const OPACITY_DIST = 24; 
const formatChem = t => { if(!t) return ""; return t.toString().replace(/([A-Z][a-z]?)(\d+)/g,'$1<sub>$2</sub>').replace(/(\d*)([+\-])/g, '<sup>$1$2</sup>').replace(/\|\|/g, '<br><br>'); };

async function init(){
    const l = document.getElementById('loader');
    // Try cloud sync, default to backup
    try {
        const r = await fetch(ENDPOINT);
        const json = await r.json();
        if(Array.isArray(json) && json.length > 0) RAW_DATA = json; 
    } catch(e) { console.log("Offline mode active"); }

    CURRENT_DATASET = "SET_A";
    if(!attemptAutoStart("Physical", "CONCEPT")){
        const first = RAW_DATA[0];
        CURRENT_DATASET = first.dataset;
        attemptAutoStart(first.topic, first.q_type);
    }
    setTimeout(() => { l.remove(); }, 800);
}

function attemptAutoStart(topic, genre){
    const cleanD = (CURRENT_DATASET||"").trim().toUpperCase();
    POOL = RAW_DATA.filter(q => (q.dataset||"").toUpperCase() === cleanD || (q.dataset||"") === "").sort(() => Math.random() - .5);
    if(POOL.length > 0) { CURRENT_TOPIC = topic; CURRENT_GENRE = genre; renderNext(); return true; }
    return false;
}

function renderNext(){
    const s=document.getElementById('stack'); s.innerHTML="";
    if(!POOL.length){ renderEnd(); return; }
    MODE="QUIZ"; const q = POOL.shift();
    const c=document.createElement('div'); c.className="card";
    c.innerHTML=`<div class="card-q">${formatChem(q.question_text)}</div>
        <div class="swipe-label sl-up">${q.swipe_up_label}</div><div class="swipe-label sl-left">${q.swipe_left_label}</div>
        <div class="swipe-label sl-right">${q.swipe_right_label}</div><div class="swipe-label sl-down sl-down-hint">ðŸ’¡ ${formatChem(q.hint)}</div>
        <div class="overlay"><div class="overlay-label">ANALYSIS</div><div class="overlay-body">${formatChem(q.explanation)}</div><button class="btn" onclick="this.parentElement.classList.remove('active')">CONTINUE</button></div>`;
    s.appendChild(c); bindPhysics(c, q);
}

function renderEnd(){
    MODE="SESSION_END"; const s=document.getElementById('stack'); s.innerHTML="";
    const c=document.createElement('div'); c.className="card";
    c.innerHTML=`
        <div class="card-q" style="font-size:1.5rem">SESSION COMPLETE<br><span style="color:var(--accent-gold); font-size:3rem">${SCORE} XP</span></div>
        <div style="width:100%; margin-top:20px;">
            <input type="text" id="student-name" class="input-name" placeholder="ENTER YOUR NAME">
            <button class="btn btn-save" onclick="submitData()">UPLOAD RESULTS</button>
            <div id="status-msg"></div>
            <button class="btn" style="background:#333; color:#fff; margin-top:20px;" onclick="location.reload()">RESTART APP</button>
        </div>`;
    s.appendChild(c);
}

async function submitData(){
    const name = document.getElementById('student-name').value;
    const btn = document.querySelector('.btn-save');
    const msg = document.getElementById('status-msg');
    
    if(!name) { msg.innerText = "Please enter a name first."; msg.style.color="red"; return; }
    
    btn.innerText = "UPLOADING...";
    btn.disabled = true;

    const payload = {
        name: name,
        score: SCORE,
        topic: CURRENT_TOPIC,
        mode: CURRENT_GENRE,
        total: SCORE + MISTAKES.length,
        mistakes: MISTAKES.map(m => m.question_text).join(" | ")
    };

    try {
        await fetch(ENDPOINT, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });
        msg.innerText = "SUCCESS! DATA SAVED.";
        msg.style.color = "#00ff00";
        btn.innerText = "SAVED";
    } catch(e) {
        msg.innerText = "UPLOAD FAILED. CHECK INTERNET.";
        msg.style.color = "red";
        btn.disabled = false;
        btn.innerText = "RETRY";
    }
}

function bindPhysics(el, data){
    let x=0, y=0, sx=0, sy=0, active=false, triggerDir=null;
    const labels={up:el.querySelector('.sl-up'), dn:el.querySelector('.sl-down'), lt:el.querySelector('.sl-left'), rt:el.querySelector('.sl-right')};
    const start=e=>{ if(isTransitioning||(el.querySelector('.overlay')&&el.querySelector('.overlay').classList.contains('active')))return; active=true; const p=e.touches?e.touches[0]:e; sx=p.clientX; sy=p.clientY; el.style.transition="none"; };
    const move=e=>{
        if(!active)return; const p=e.touches?e.touches[0]:e;
        const rawDx = p.clientX - sx; const rawDy = p.clientY - sy; const rawDist = Math.sqrt(rawDx*rawDx + rawDy*rawDy);
        const opacity = Math.min(rawDist / OPACITY_DIST, 1);
        let clampedDx = rawDx, clampedDy = rawDy;
        if(rawDist > CLAMP_DIST){ const ratio = CLAMP_DIST / rawDist; clampedDx = rawDx * ratio; clampedDy = rawDy * ratio; }
        let ang = Math.atan2(-clampedDy, clampedDx)*(180/Math.PI); if(ang<0) ang+=360;
        let activeLabel = null; Object.values(labels).forEach(l=>{if(l)l.style.opacity=0;});
        if(rawDist > 5){
            if(ang>=45&&ang<135) activeLabel=labels.up; else if(ang>=135&&ang<225) activeLabel=labels.lt;
            else if(ang>=225&&ang<315) activeLabel=labels.dn; else activeLabel=labels.rt;
        }
        if(activeLabel){ activeLabel.style.opacity = opacity; activeLabel.style.transform = `scale(${0.85 + (opacity * 0.15)})`; }
        x = clampedDx; y = clampedDy; requestAnimationFrame(()=>{ el.style.transform=`translate3d(${x}px,${y}px,0) rotate(${x/25}deg)`; });
        if(rawDist >= CLAMP_DIST) triggerDir = (ang>=45&&ang<135)?"UP":(ang>=135&&ang<225)?"LEFT":(ang>=225&&ang<315)?"DOWN":"RIGHT"; else triggerDir = null;
    };
    const end=()=>{
        if(!active)return; active=false;
        if(triggerDir){
            // V78.2 LOGIC: Down swipe = Hint Peek (Bounce back). UP/LEFT/RIGHT = Answer.
            if(MODE==="QUIZ" && triggerDir==="DOWN"){ 
                el.style.transition="transform .3s"; 
                el.style.transform="translate3d(0,0,0) rotate(0deg)"; 
            }
            else {
                handleAction(el, data, x, y, triggerDir);
            }
        } else { el.style.transition="transform .2s cubic-bezier(0.175, 0.885, 0.32, 1.275)"; el.style.transform="translate3d(0,0,0) rotate(0deg)"; }
        Object.values(labels).forEach(l=>{if(l)l.style.opacity=0;});
    };
    el.onmousedown=start; window.onmousemove=move; window.onmouseup=end; el.ontouchstart=start; el.ontouchmove=move; el.ontouchend=end;
}

function handleAction(el, data, x, y, dir){
    isTransitioning=true;
    if(MODE==="QUIZ"){ 
        const w=parseInt(data.weight)||1; 
        if(dir===data.correct.toUpperCase()){ 
            SCORE+=(10*w); 
            renderNext(); // Correct = Instant Next
        } 
        else { 
            SCORE=Math.max(0, SCORE-5); MISTAKES.push(data); 
            // Wrong = Show Analysis Popup
            el.querySelector('.overlay').classList.add('active');
            el.style.transition="transform .3s";
            el.style.transform="translate3d(0,0,0) rotate(0deg)";
            isTransitioning=false; 
            return; 
        }
    }
    // Handle Navigation Logic (Menus)
    else if(MODE==="DATASET_SELECT"){ const map={UP:"SET_A", LEFT:"SET_B", RIGHT:"SET_C", DOWN:"SET_D"}; renderTopicSelect(map[dir]); }
    else if(MODE==="TOPIC_SELECT"){ const map={UP:"Physical", LEFT:"Organic", RIGHT:"Inorganic", DOWN:"Analytical"}; renderGenreSelect(map[dir]); }
    else if(MODE==="GENRE_SELECT"){ 
        if(dir==="UP") startQuiz(CURRENT_TOPIC, "CONCEPT"); 
        else if(dir==="DOWN") startQuiz(CURRENT_TOPIC, "APPLICATION"); 
        else { isTransitioning=false; return; }
    }
    else if(MODE==="SESSION_END"){ 
        if(dir==="UP") location.reload(); // Restart
    }
    
    // Animate Card Away
    el.style.transition="transform .4s ease-in"; 
    el.style.transform=`translate3d(${x*6}px,${y*6}px,0) rotate(${x/5}deg)`;
    updateUI(); 
    setTimeout(()=>{el.remove(); isTransitioning=false;}, 350);
}
function updateUI(){ document.getElementById('xp-ui').innerText=`${SCORE} XP`; document.getElementById('progress-bar').style.width=`${(SCORE%100)}%`; }
window.onload=init;
</script>
</body>
</html>
