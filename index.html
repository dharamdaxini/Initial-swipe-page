<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#18181b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Strategic Convergence 2026</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600;800&display=swap');
        
        :root {
            --bg-deep: #09090b; --bg-surface: #18181b; --bg-card: #ffffff;
            --text-primary: #f4f4f5; --text-secondary: #a1a1aa; --text-inverse: #18181b;
            --accent-brand: #3b82f6; --accent-success: #22c55e; --accent-danger: #ef4444; 
            --accent-warning: #eab308; --accent-neutral: #71717a;
            --shadow-card: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; touch-action: none; user-select: none; -webkit-user-select: none; }
        body { font-family: 'Inter', sans-serif; background-color: #000; color: var(--text-primary); height: 100svh; width: 100vw; overflow: hidden; display: flex; justify-content: center; align-items: center; }

        #app-shell { position: relative; width: 100%; height: 100%; max-width: 450px; max-height: 900px; background-color: var(--bg-deep); display: flex; flex-direction: column; overflow: hidden; }

        /* VIEWS */
        .view { position: absolute; inset: 0; display: flex; flex-direction: column; padding: 1.5rem; opacity: 0; pointer-events: none; transform: scale(0.95); transition: opacity 0.4s ease, transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); z-index: 1; }
        .view.active { opacity: 1; pointer-events: auto; transform: scale(1); z-index: 10; }

        /* START SCREEN */
        #view-start { justify-content: center; align-items: center; text-align: center; background: radial-gradient(circle at top right, #27272a 0%, #09090b 60%); }
        .logo-mark { font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--accent-brand); padding: 0.5rem 1rem; border: 1px solid var(--accent-brand); border-radius: 100px; margin-bottom: 2rem; }
        h1.title-hero { font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; background: linear-gradient(to bottom right, #fff, #a1a1aa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        button.btn-primary { background: var(--text-primary); color: var(--bg-deep); border: none; padding: 1rem 2.5rem; font-size: 1.1rem; font-weight: 700; border-radius: 100px; cursor: pointer; transition: transform 0.1s; }
        button.btn-primary:active { transform: scale(0.96); }

        /* GAME SCREEN */
        #view-game { display: grid; grid-template-rows: 15% 1fr 25%; padding: 0; }
        .game-header { display: flex; flex-direction: column; justify-content: flex-end; align-items: center; padding-bottom: 1rem; z-index: 20; }
        .progress-bar-container { width: 80%; height: 4px; background: #27272a; border-radius: 10px; margin-bottom: 1rem; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--accent-brand); width: 0%; transition: width 0.3s ease; }
        .topic-badge { font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.15em; color: var(--text-secondary); margin-bottom: 0.25rem; }
        .type-heading { font-size: 1.25rem; font-weight: 800; text-transform: uppercase; }

        .card-stack-container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; perspective: 1200px; }
        .card { position: absolute; width: 85%; aspect-ratio: 1/1.1; background: var(--bg-card); border-radius: 24px; box-shadow: var(--shadow-card); display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 2rem; text-align: center; will-change: transform; transform-style: preserve-3d; top: 50%; left: 50%; margin-top: -55%; margin-left: -42.5%; }
        .card p { font-size: 1.4rem; font-weight: 600; color: var(--text-inverse); pointer-events: none; margin: 0; line-height: 1.4; }

        .game-footer { display: grid; grid-template-columns: 1fr 80px 1fr; grid-template-rows: 1fr 1fr; align-content: center; justify-items: center; padding-bottom: 2rem; z-index: 20; }
        .control-item { display: flex; flex-direction: column; align-items: center; color: var(--text-secondary); transition: transform 0.1s; }
        .control-item.up { grid-column: 2; grid-row: 1; margin-bottom: 0.5rem; } .control-item.down { grid-column: 2; grid-row: 2; margin-top: 0.5rem; }
        .control-item.left { grid-column: 1; grid-row: 2; } .control-item.right { grid-column: 3; grid-row: 2; }
        .control-icon { font-size: 1.8rem; display: block; line-height: 1; } .control-label { font-size: 0.65rem; font-weight: 700; text-transform: uppercase; }

        /* SUMMARY SCREEN */
        #view-summary { overflow-y: auto; background: var(--bg-surface); padding: 2rem 1.5rem; }
        .score-display { background: #27272a; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; display: flex; justify-content: space-around; }
        .stat-val { font-size: 2rem; font-weight: 800; display: block; } .stat-lbl { font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; }
        .history-card { background: #27272a; padding: 1rem; border-radius: 12px; border-left: 4px solid #71717a; margin-bottom: 1rem; }
        .history-card.correct { border-left-color: var(--accent-success); } .history-card.incorrect { border-left-color: var(--accent-danger); }
        
        .fab-container { position: absolute; bottom: 2rem; left: 0; right: 0; display: flex; justify-content: center; pointer-events: none; }
        .slider-confirm { width: 80%; height: 60px; background: #3f3f46; border-radius: 100px; position: relative; pointer-events: auto; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .slider-text { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 600; color: rgba(255,255,255,0.3); pointer-events: none; }
        .slider-knob { width: 60px; height: 60px; background: var(--text-primary); border-radius: 50%; position: absolute; top: 0; left: 0; display: flex; align-items: center; justify-content: center; color: var(--bg-deep); font-size: 1.2rem; box-shadow: 2px 0 5px rgba(0,0,0,0.2); touch-action: none; }
    </style>
</head>
<body>

    <div id="app-shell">
        <section id="view-start" class="view active">
            <div class="logo-mark">STRATEGIC CONVERGENCE</div>
            <h1 class="title-hero">Operator<br>Exam 2026</h1>
            <p style="color:#a1a1aa; margin-bottom:3rem; max-width:300px;">30-question assessment testing situational awareness, timeline realism, and convergence logic.</p>
            <button class="btn-primary" onclick="APP.transitionToGame()">INITIATE</button>
        </section>

        <section id="view-game" class="view">
            <header class="game-header">
                <div class="progress-bar-container"><div class="progress-bar-fill" id="ui-progress"></div></div>
                <span class="topic-badge" id="ui-topic">TOPIC</span>
                <span class="type-heading" id="ui-type">TYPE</span>
            </header>
            <div class="card-stack-container" id="card-stack"></div>
            <footer class="game-footer" id="ui-footer">
                <div class="control-item up"><span class="control-icon">↑</span><span class="control-label" id="lbl-up">True</span></div>
                <div class="control-item left"><span class="control-icon">←</span><span class="control-label" id="lbl-left">Skip</span></div>
                <div class="control-item down"><span class="control-icon">↓</span><span class="control-label" id="lbl-down">False</span></div>
                <div class="control-item right"><span class="control-icon">→</span><span class="control-label" id="lbl-right">Unsure</span></div>
            </footer>
        </section>

        <section id="view-summary" class="view">
            <h2 class="type-heading" style="text-align:center; margin-bottom:1.5rem;">Mission Report</h2>
            <div class="score-display">
                <div style="text-align:center"><span class="stat-val" id="stat-score">0</span><span class="stat-lbl">Points</span></div>
                <div style="text-align:center"><span class="stat-val" id="stat-acc">0%</span><span class="stat-lbl">Accuracy</span></div>
            </div>
            <div id="history-list" style="padding-bottom:100px;"></div>
            <div class="fab-container">
                <div class="slider-confirm" id="slider-confirm">
                    <div class="slider-text">SLIDE TO SUBMIT</div>
                    <div class="slider-knob" id="slider-knob">➜</div>
                </div>
            </div>
        </section>
    </div>

    <script>
        const CONFIG = {
            API_URL: "https://script.google.com/macros/s/AKfycbz_ziu5Dezrz35J2FksQtNEYuZ5Kk6TrQvg3pM5O5eBYUDzWCCtqlGWwZj8D-TBQLFw/exec",
            THRESHOLD: 80, 
            COLORS: { UP: '#22c55e', DOWN: '#ef4444', RIGHT: '#eab308', LEFT: '#64748b' }
        };

        const QUESTION_BANK = [
            { id: "s1", topic: "Strategic", type: "FACT", text: "Dholera fab is shipping 28nm commercial wafers.", up:"True", down:"False", right:"Plausible", left:"Skip", correct:"up", w:1 },
            { id: "s2", topic: "Strategic", type: "CONTEXT", text: "India's molten salt reactor prototype is grid-connected.", up:"Yes", down:"No", right:"Unsure", left:"Skip", correct:"right", w:2 },
            { id: "s3", topic: "Strategic", type: "TRAP", text: "India formally joined the G7 as a permanent member in 2025.", up:"True", down:"False", right:"Observer", left:"Skip", correct:"down", w:1 },
            { id: "s4", topic: "Strategic", type: "REASONING", text: "IMEC corridor construction paused due to regional conflict.", up:"True", down:"False", right:"Partially", left:"Skip", correct:"up", w:2 },
            { id: "s5", topic: "Defense", type: "FACT", text: "Tejas Mk1A delivery to IAF has crossed 50 units.", up:"True", down:"False", right:"Unsure", left:"Skip", correct:"up", w:1 },
            { id: "e1", topic: "Trade", type: "CONTEXT", text: "Rupee trade settlement volume with UAE exceeded $50B.", up:"True", down:"False", right:"Unsure", left:"Skip", correct:"up", w:2 },
            { id: "e2", topic: "Trade", type: "TRAP", text: "India signed a full FTA with the United States.", up:"True", down:"False", right:"Mini-deal", left:"Skip", correct:"down", w:1 },
            { id: "e3", topic: "Infra", type: "FACT", text: "Mumbai-Ahmedabad Bullet Train is fully operational.", up:"True", down:"False", right:"Partial", left:"Skip", correct:"right", w:1 },
            { id: "g1", topic: "Neighbors", type: "CONTEXT", text: "Pakistan trade normalization talks have officially resumed.", up:"True", down:"False", right:"Backchannel", left:"Skip", correct:"right", w:2 },
            { id: "g2", topic: "Ocean", type: "FACT", text: "Indian Navy has 3 operational Aircraft Carriers.", up:"True", down:"False", right:"Two", left:"Skip", correct:"down", w:1 }
        ];

        const STORE = {
            state: { deck: [], currentIndex: 0, answers: {} },
            init() { this.state.deck = [...QUESTION_BANK].sort(() => Math.random() - 0.5); },
            saveAnswer(qId, dir) {
                const q = this.state.deck.find(x => x.id === qId);
                let score = dir === q.correct ? 10 * q.w : (dir === 'left' ? 0 : -5);
                this.state.answers[qId] = { dir, score, correct: dir === q.correct, q };
            }
        };

        const APP = {
            dom: { 
                start: document.getElementById('view-start'), game: document.getElementById('view-game'), summary: document.getElementById('view-summary'),
                stack: document.getElementById('card-stack'), progress: document.getElementById('ui-progress'), topic: document.getElementById('ui-topic'), type: document.getElementById('ui-type')
            },
            transitionToGame() {
                STORE.init();
                this.dom.start.classList.remove('active');
                this.dom.game.classList.add('active');
                this.renderStack();
            },
            renderStack() {
                this.dom.stack.innerHTML = '';
                const deck = STORE.state.deck;
                const idx = STORE.state.currentIndex;
                if (idx >= deck.length) return this.finishGame();

                // Render next 2 cards
                const visible = deck.slice(idx, idx + 2).reverse();
                visible.forEach((q, i) => {
                    const realIdx = idx + (visible.length - 1 - i);
                    const el = document.createElement('div');
                    el.className = 'card';
                    if (realIdx === idx) { el.id = 'active-card'; el.style.zIndex = 100; }
                    else { el.style.transform = 'scale(0.95) translateY(10px)'; el.style.opacity = 0.5; el.style.zIndex = 90; }
                    el.innerHTML = `<p>${q.text}</p>`;
                    this.dom.stack.appendChild(el);
                });
                this.updateUI();
            },
            updateUI() {
                const q = STORE.state.deck[STORE.state.currentIndex];
                this.dom.topic.textContent = q.topic;
                this.dom.type.textContent = q.type;
                this.dom.progress.style.width = `${(STORE.state.currentIndex / STORE.state.deck.length) * 100}%`;
                
                document.getElementById('lbl-up').textContent = q.up;
                document.getElementById('lbl-down').textContent = q.down;
                document.getElementById('lbl-left').textContent = q.left;
                document.getElementById('lbl-right').textContent = q.right;

                PHYSICS.bind(document.getElementById('active-card'));
            },
            finishGame() {
                this.dom.game.classList.remove('active');
                this.dom.summary.classList.add('active');
                this.renderSummary();
            },
            renderSummary() {
                const answers = Object.values(STORE.state.answers);
                const score = answers.reduce((a, b) => a + b.score, 0);
                const acc = Math.round((answers.filter(a => a.correct).length / STORE.state.deck.length) * 100);
                
                document.getElementById('stat-score').textContent = score;
                document.getElementById('stat-acc').textContent = acc + '%';
                
                const list = document.getElementById('history-list');
                answers.forEach(a => {
                    const div = document.createElement('div');
                    div.className = `history-card ${a.correct ? 'correct' : 'incorrect'}`;
                    div.innerHTML = `<span style="font-size:0.7rem; color:#a1a1aa; text-transform:uppercase">${a.q.topic}</span><p style="margin:0.5rem 0; font-size:0.9rem">${a.q.text}</p><div style="display:flex; justify-content:space-between; font-size:0.8rem; font-weight:700"><span>YOU: ${a.dir.toUpperCase()}</span><span>${a.score} PTS</span></div>`;
                    list.appendChild(div);
                });
                SLIDER.init();
            }
        };

        const PHYSICS = {
            card: null, startX: 0, startY: 0, isDragging: false,
            bind(el) {
                if(!el) return;
                this.card = el;
                el.addEventListener('touchstart', this.start.bind(this), {passive:false});
                el.addEventListener('mousedown', this.start.bind(this));
            },
            start(e) {
                if(e.touches && e.touches.length > 1) return;
                this.isDragging = true;
                const p = e.touches ? e.touches[0] : e;
                this.startX = p.clientX; this.startY = p.clientY;
                this.card.style.transition = 'none';
                window.addEventListener('touchmove', this.move.bind(this), {passive:false});
                window.addEventListener('touchend', this.end.bind(this));
                window.addEventListener('mousemove', this.move.bind(this));
                window.addEventListener('mouseup', this.end.bind(this));
            },
            move(e) {
                if(!this.isDragging) return;
                e.preventDefault();
                const p = e.touches ? e.touches[0] : e;
                const dx = p.clientX - this.startX;
                const dy = p.clientY - this.startY;
                this.card.style.transform = `translate(${dx}px, ${dy}px) rotate(${dx * 0.05}deg)`;
                this.animateUI(dx, dy);
            },
            end(e) {
                if(!this.isDragging) return;
                this.isDragging = false;
                window.removeEventListener('touchmove', this.move.bind(this));
                window.removeEventListener('touchend', this.end.bind(this));
                window.removeEventListener('mousemove', this.move.bind(this));
                window.removeEventListener('mouseup', this.end.bind(this));

                const p = e.changedTouches ? e.changedTouches[0] : e;
                const dx = p.clientX - this.startX;
                const dy = p.clientY - this.startY;
                
                if (Math.abs(dy) > Math.abs(dx) && Math.abs(dy) > CONFIG.THRESHOLD) this.commit(dy < 0 ? 'up' : 'down');
                else if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > CONFIG.THRESHOLD) this.commit(dx > 0 ? 'right' : 'left');
                else this.reset();
            },
            animateUI(dx, dy) {
                const footer = document.getElementById('ui-footer');
                const items = footer.querySelectorAll('.control-item');
                let cls = '';
                if(Math.abs(dy) > Math.abs(dx)) cls = dy < 0 ? 'up' : 'down';
                else cls = dx > 0 ? 'right' : 'left';
                items.forEach(i => {
                    if(i.classList.contains(cls)) { i.style.transform = 'scale(1.2)'; i.style.color = CONFIG.COLORS[cls.toUpperCase()]; }
                    else { i.style.transform = 'scale(1)'; i.style.color = '#71717a'; }
                });
            },
            reset() {
                this.card.style.transition = 'transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1)';
                this.card.style.transform = 'translate(0,0) rotate(0)';
                document.querySelectorAll('.control-item').forEach(i => { i.style.transform = ''; i.style.color = ''; });
            },
            commit(dir) {
                const qId = STORE.state.deck[STORE.state.currentIndex].id;
                STORE.saveAnswer(qId, dir);
                
                let tx=0, ty=0; const d = 800;
                if(dir==='up') ty=-d; if(dir==='down') ty=d; if(dir==='left') tx=-d; if(dir==='right') tx=d;
                
                this.card.style.transition = 'transform 0.4s ease-in';
                this.card.style.transform = `translate(${tx}px, ${ty}px) rotate(${tx*0.1}deg)`;
                document.querySelectorAll('.control-item').forEach(i => { i.style.transform = ''; i.style.color = ''; });
                
                setTimeout(() => {
                    this.card.remove();
                    STORE.state.currentIndex++;
                    APP.renderStack();
                }, 300);
            }
        };

        const SLIDER = {
            knob: null, container: null, startX: 0, active: false,
            init() {
                this.knob = document.getElementById('slider-knob');
                this.container = document.getElementById('slider-confirm');
                this.knob.addEventListener('touchstart', this.start.bind(this), {passive:false});
                this.knob.addEventListener('mousedown', this.start.bind(this));
            },
            start(e) {
                this.active = true;
                this.startX = (e.touches ? e.touches[0] : e).clientX;
                window.addEventListener('touchmove', this.move.bind(this), {passive:false});
                window.addEventListener('touchend', this.end.bind(this));
                window.addEventListener('mousemove', this.move.bind(this));
                window.addEventListener('mouseup', this.end.bind(this));
            },
            move(e) {
                if(!this.active) return;
                const x = (e.touches ? e.touches[0] : e).clientX - this.startX;
                const max = this.container.offsetWidth - this.knob.offsetWidth;
                const safe = Math.max(0, Math.min(x, max));
                this.knob.style.transform = `translateX(${safe}px)`;
                if(safe >= max - 5) { this.active = false; this.submit(); }
            },
            end() {
                if(!this.active) return;
                this.active = false;
                this.knob.style.transition = 'transform 0.3s ease';
                this.knob.style.transform = 'translateX(0)';
                setTimeout(()=>this.knob.style.transition = 'none', 300);
            },
            submit() {
                const txt = this.container.querySelector('.slider-text');
                txt.textContent = "SYNCING...";
                this.knob.style.background = CONFIG.COLORS.UP;
                
                fetch(CONFIG.API_URL, {
                    method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ answers: STORE.state.answers, score: document.getElementById('stat-score').textContent, timestamp: new Date().toISOString() })
                }).then(() => {
                    txt.textContent = "SUBMITTED";
                    this.container.style.background = CONFIG.COLORS.UP;
                }).catch(() => {
                    txt.textContent = "ERROR";
                    this.container.style.background = CONFIG.COLORS.DOWN;
                });
            }
        };
        
        // Prevent scroll bounce
        document.body.addEventListener('touchmove', function(e) { e.preventDefault(); }, { passive: false });
    </script>
</body>
</html>
    </script>
</body>
</html>
