<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V37.5 Cognitive Engine | Production</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    
    <style>
        :root { --bg: #000; --card: #fff; --accent: #2563eb; --text: #1a1a1a; }
        body, html { margin: 0; padding: 0; height: 100%; background: var(--bg); font-family: sans-serif; overflow: hidden; touch-action: none; }
        #app { position: relative; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .view { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; justify-content: center; position: absolute; }
        .active { display: flex; }
        
        /* V37 UI: 40px Rounded Cards */
        .card {
            width: 85%; max-width: 420px; height: 65vh; background: var(--card); border-radius: 40px;
            padding: 2.5rem; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; justify-content: space-between;
            transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1); position: relative; z-index: 5;
        }
        
        .q-text { font-size: 1.3rem; font-weight: 800; color: var(--text); line-height: 1.4; margin-bottom: 1rem; }
        .opt-list { flex-grow: 1; }
        .opt-item { 
            font-size: 1.05rem; margin-bottom: 12px; display: flex; align-items: flex-start; color: #333; 
        }
        .opt-item::before { content: "•"; color: var(--accent); font-size: 1.8rem; margin-right: 12px; line-height: 1; }
        
        .hint { font-size: 0.7rem; color: #888; text-align: center; letter-spacing: 1.5px; text-transform: uppercase; }
        
        button {
            padding: 1.2rem 3rem; border-radius: 100px; border: none; background: var(--accent);
            color: white; font-weight: 900; font-size: 1rem; cursor: pointer; transition: 0.2s;
        }
        button:active { transform: scale(0.95); }
    </style>
</head>
<body>

<div id="app">
    <div id="view-start" class="view active">
        <h2 style="color:white; letter-spacing:2px;">CHEMISTRY V37.5</h2>
        <button onclick="APP.start()">START ASSESSMENT</button>
    </div>

    <div id="view-game" class="view">
        <div id="main-card" class="card">
            <div id="q-text" class="q-text"></div>
            <div class="opt-list">
                <div id="o1" class="opt-item"></div>
                <div id="o2" class="opt-item"></div>
                <div id="o3" class="opt-item"></div>
            </div>
            <div class="hint">↑ Opt 1 | ← Opt 2 | → Opt 3 | ↓ PoE Map</div>
        </div>
    </div>

    <div id="view-summary" class="view">
        <h1 style="color:white;">Session Synced</h1>
        <p id="stat-text" style="color:#888;"></p>
        <button onclick="location.reload()">NEW SESSION</button>
    </div>
</div>

<script>
const QUESTIONS = [
    {id:"AS_01", q:"Synthesis of $t$-butyl methyl ether via Williamson Ether Synthesis.", o1:"$(CH_3)_3C-Br + CH_3ONa$", o2:"$(CH_3)_3CONa + CH_3I$ in $H_2O$", o3:"$(CH_3)_3CONa + CH_3I$ in $CH_3CN$", map:"Eliminate 1: 3° halides do E2. Eliminate 2: Protic solvate nucleophile."},
    {id:"AS_02", q:"Friedel-Crafts Alkylation of Nitrobenzene + $CH_3Cl/AlCl_3$.", o1:"Toluene formation", o2:"$o/p$-Nitrotoluene", o3:"No Reaction", map:"Eliminate 1&2: -NO2 ring is too deactivated for F-C."},
    {id:"AS_04", q:"$S_N2$ displacement of $(S)$-2-bromobutane with $NaN_3$.", o1:"$(S)$-2-azidobutane", o2:"$(R)$-2-azidobutane in $CH_3OH$", o3:"$(R)$-2-azidobutane in $DMSO$", map:"Eliminate 1: Inversion required. Eliminate 2: Protic solvent kills speed."},
    {id:"AS_14", q:"Swern Oxidation of $1^\\circ$ Alcohol conditions.", o1:"$PCC$ in $CH_2Cl_2$", o2:"$(COCl)_2/DMSO$ at $25^\\circ C$", o3:"$(COCl)_2/DMSO$ at $-78^\\circ C$", map:"Eliminate 2: Reagent explodes above -60°C."}
    // Logic: The array grows, but the code remains lean.
];

const APP = {
    deck: [],
    idx: 0,
    logs: [],
    ts: 0,
    coords: {x:0, y:0},

    shuffle(a) {
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    },

    start() {
        this.deck = this.shuffle([...QUESTIONS]);
        this.idx = 0;
        this.logs = [];
        this.show('view-game');
        this.render();
    },

    show(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    },

    render() {
        if(this.idx >= this.deck.length) return this.end();
        const data = this.deck[this.idx];
        document.getElementById('q-text').innerHTML = data.q;
        document.getElementById('o1').innerHTML = data.o1;
        document.getElementById('o2').innerHTML = data.o2;
        document.getElementById('o3').innerHTML = data.o3;
        
        const card = document.getElementById('main-card');
        card.style.transform = `translate(0,0) rotate(0) scale(1)`;
        
        if (window.renderMathInElement) renderMathInElement(card, {delimiters:[{left:"$",right:"$",display:false}]});
        this.ts = Date.now();
    },

    swipe(dir) {
        const latency = Date.now() - this.ts;
        const current = this.deck[this.idx];
        
        const card = document.getElementById('main-card');
        const anims = {
            'UP': 'translateY(-100vh) rotate(10deg)',
            'LEFT': 'translateX(-100vw) rotate(-15deg)',
            'RIGHT': 'translateX(100vw) rotate(15deg)',
            'DOWN': 'scale(0.5) translateY(100vh)'
        };

        card.style.transform = anims[dir];

        setTimeout(() => {
            if(dir === 'DOWN') {
                alert(`PoE Logic: ${current.map}`);
                card.style.transform = 'translate(0,0) scale(1)';
            } else {
                this.logs.push({id: current.id, vector: dir, ms: latency});
                this.idx++;
                this.render();
            }
        }, 300);
    },

    end() {
        this.show('view-summary');
        document.getElementById('stat-text').innerText = `Batch Logged: ${this.logs.length} Vectors`;
        console.table(this.logs); // Your Relational Logging Data
    }
};

// Gesture Core
const card = document.getElementById('main-card');
card.addEventListener('touchstart', e => {
    APP.coords.x = e.touches[0].clientX;
    APP.coords.y = e.touches[0].clientY;
});

card.addEventListener('touchend', e => {
    const dx = e.changedTouches[0].clientX - APP.coords.x;
    const dy = e.changedTouches[0].clientY - APP.coords.y;
    const t = 60;

    if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > t) APP.swipe('RIGHT');
        else if (dx < -t) APP.swipe('LEFT');
    } else {
        if (dy > t) APP.swipe('DOWN');
        else if (dy < -t) APP.swipe('UP');
    }
});
</script>
</body>
</html>
